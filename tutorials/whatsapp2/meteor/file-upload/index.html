<!DOCTYPE html><html lang="en"><head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,800,700italic,800italic" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700" rel="stylesheet">

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>Tutorial | WhatsApp Clone with Ionic 2 and Meteor CLI | File Upload &amp; Images</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="google-site-verification" content="CRBoDT1qxdDxv-sysHgNqqEy9Ijc-fybbmM2VhOUv3w">
  <base href="/">

  <meta name="description" content="In this step, we will be using Ionic 2 to pick up some images from our device&amp;#39;s gallery, and we will use them to send pictures, and to set our pro">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="keywords" content="realtime, backend, websockets, graphql, apollo, angular, angular 2, meteor, Angular Bindings, realtime sync, browser, mobile, build apps fast, completely realtime, build collaborative apps, real-time, MEAN stack, JSON data, Easy authentication, oAuth, Real-time Synchronization. angular stack, MongoDB, Node.js, File, Upload, &amp;, Images">
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/rss+xml" title="Meteor Blog RSS Feed" href="http://info.meteor.com/blog/rss.xml">
  <link rel="author" href="https://plus.google.com/105270147965228044669">
  <link href="https://plus.google.com/104063475472216743156" rel="publisher">
  <meta name="twitter:creator" content="@urigoldshtein">
  <link rel="profile" href="http://angular-meteor.com">
  <meta property="os:repo" content="https://github.com/urigo/angular-meteor">
  <meta property="os:rcs_type" content="git">
  <meta property="os:src" content="git@github.com:urigo/angular-meteor.git">
  <script type="text/javascript">
    var host = "angular-meteor.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
  </script>
  <script>
    (function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.fitvids=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var selectors=['iframe[src*="player.vimeo.com"]','iframe[src*="youtube.com"]','iframe[src*="youtube-nocookie.com"]','iframe[src*="kickstarter.com"][src*="video.html"]',"object"];var css=".fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}";module.exports=function(parentSelector,opts){parentSelector=parentSelector||"body";opts=opts||{};if(isObject(parentSelector)){opts=parentSelector;parentSelector="body"}opts.ignore=opts.ignore||"";opts.players=opts.players||"";var containers=queryAll(parentSelector);if(!hasLength(containers))return;if(!document.getElementById("fit-vids-style")){var head=document.head||document.getElementsByTagName("head")[0];head.appendChild(styles())}var custom=toSelectorArray(opts.players)||[];var ignored=toSelectorArray(opts.ignore)||[];var selector=selectors.filter(notIgnored(ignored)).concat(custom).join();if(!hasLength(selector))return;containers.forEach(function(container){var videos=queryAll(container,selector);videos.forEach(function(video){wrap(video)})})};function queryAll(el,selector){if(typeof el==="string"){selector=el;el=document}return Array.prototype.slice.call(el.querySelectorAll(selector))}function toSelectorArray(input){if(typeof input==="string"){return input.split(",").map(trim).filter(hasLength)}else if(isArray(input)){return flatten(input.map(toSelectorArray).filter(hasLength))}return input||[]}function wrap(el){if(/fluid-width-video-wrapper/.test(el.parentNode.className))return;var widthAttr=parseInt(el.getAttribute("width"),10);var heightAttr=parseInt(el.getAttribute("height"),10);var width=!isNaN(widthAttr)?widthAttr:el.clientWidth;var height=!isNaN(heightAttr)?heightAttr:el.clientHeight;var aspect=height/width;el.removeAttribute("width");el.removeAttribute("height");var wrapper=document.createElement("div");el.parentNode.insertBefore(wrapper,el);wrapper.className="fluid-width-video-wrapper";wrapper.style.paddingTop=aspect*100+"%";wrapper.appendChild(el)}function styles(){var div=document.createElement("div");div.innerHTML='<p>x</p><style id="fit-vids-style">'+css+"</style>";return div.childNodes[1]}function notIgnored(ignored){if(ignored.length<1){return function(){return true}}return function(selector){return ignored.indexOf(selector)===-1}}function hasLength(input){return input.length>0}function trim(str){return str.replace(/^\s+|\s+$/g,"")}function flatten(input){return[].concat.apply([],input)}function isObject(input){return Object.prototype.toString.call(input)==="[object Object]"}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]"}},{}]},{},[1])(1)});
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Fix for CSS load delay
      document.body.style.display = "block";

      // Tutorials dropdown
      var navToggle = document.querySelector('.nav-toggle');
      var navLinks = document.querySelector('.nav-links');

      var dropdown = document.querySelector('.tutorials-dropdown');
      var dropdownContent = document.querySelector('.dropdown-content');

      navToggle.addEventListener('click', function() {
        navLinks.classList.toggle('visible');
      });

      dropdown.addEventListener('click', function() {
        dropdownContent.classList.toggle('visible');
	    });

      // Fix for youtube
	    fitvids('.youtube-container');

	    // Command line code snippet
      document.querySelectorAll('.tutorial-content pre code').forEach(function(item){
        item.addEventListener('click', function(event) {
          var target = event.target;
          var width = target.offsetWidth;
          var dollarIndex = target.innerText.indexOf('$ ');

          if (dollarIndex > -1) {
            var inputElement = document.createElement('textarea');
            inputElement.innerHTML = target.innerText.replace(/\r?\n/g, '\n').replace(/\n$/, "").trim();
            var linesCounts = inputElement.innerHTML.split("\n").length;
            inputElement.setAttribute("spellcheck", "false");
            inputElement.setAttribute("rows", linesCounts);
            var startIndex = dollarIndex;
            var endIndex = inputElement.value.length;

            if (target.innerText.trim().indexOf("\n") > -1) {
              endIndex = target.innerText.trim().indexOf("\n");
            }

            window.setTimeout(function () {
              inputElement.setSelectionRange(startIndex + 2, endIndex);
            }, 0);

            inputElement.className = 'terminal-input';
            inputElement.style.width = width + 'px';
            inputElement.style.lineHeight = window.getComputedStyle(target, null).getPropertyValue('line-height');

            var t = target.parentNode.replaceChild(inputElement, target);

            inputElement.addEventListener('blur', function() {
              inputElement.parentNode.replaceChild(t, inputElement);
            });

            inputElement.focus();
          }
        });
      });

    }, false);
  </script>
<style>/** * Mixin that creates a new stacking context. * see https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context */ /** * This mixin hides an element visually. * That means it's still accessible for screen-readers but not visible in view. */ /** * Forces an element to grow to fit floated contents; used as as an alternative to * `overflow: hidden;` because it doesn't cut off contents. */ /** * A mixin, which generates temporary ink ripple on a given component. * When $bindToParent is set to true, it will check for the focused class on the same selector as you included * that mixin. * It is also possible to specify the color palette of the temporary ripple. By default it uses the * accent palette for its background. */ md-toolbar { display: flex; box-sizing: border-box; width: 100%; min-height: 64px; font-size: 20px; font-weight: 400; font-family: Roboto, "Helvetica Neue", sans-serif; padding: 0 16px; flex-direction: column; background: whitesmoke; color: rgba(0, 0, 0, 0.87); } md-toolbar.md-primary { background: #009688; color: white; } md-toolbar.md-accent { background: #9c27b0; color: rgba(255, 255, 255, 0.870588); } md-toolbar.md-warn { background: #f44336; color: white; } md-toolbar md-toolbar-row { display: flex; box-sizing: border-box; width: 100%; height: 64px; flex-direction: row; align-items: center; } /*# sourceMappingURL=toolbar.css.map */ </style><style>/** * A collection of mixins and CSS classes that can be used to apply elevation to a material * element. * See: https://www.google.com/design/spec/what-is-material/elevation-shadows.html * Examples: * * * .md-foo { *   @include $md-elevation(2); * *   &:active { *     @include $md-elevation(8); *   } * } * * <div id="external-card" class="md-elevation-z2"><p>Some content</p></div> * * For an explanation of the design behind how elevation is implemented, see the design doc at * https://goo.gl/Kq0k9Z. */ /** * The css property used for elevation. In most cases this should not be changed. It is exposed * as a variable for abstraction / easy use when needing to reference the property directly, for * example in a will-change rule. */ /** The default duration value for elevation transitions. */ /** The default easing value for elevation transitions. */ /** * Applies the correct css rules to an element to give it the elevation specified by $zValue. * The $zValue must be between 0 and 24. */ /** * Returns a string that can be used as the value for a transition property for elevation. * Calling this function directly is useful in situations where a component needs to transition * more than one property. * * .foo { *   transition: md-elevation-transition-property-value(), opacity 100ms ease; *   will-change: $md-elevation-property, opacity; * } */ /** * Applies the correct css rules needed to have an element transition between elevations. * This mixin should be applied to elements whose elevation values will change depending on their * context (e.g. when active or disabled). */ /** * This mixin overrides default button styles like the gray background, * the border, and the outline. */ /** Applies a property to an md-button element for each of the supported palettes. */ /** Applies a focus style to an md-button element for each of the supported palettes. */ [md-raised-button], [md-fab], [md-mini-fab], [md-button], [md-icon-button] { box-sizing: border-box; position: relative; background: transparent; cursor: pointer; user-select: none; outline: none; border: none; display: inline-block; white-space: nowrap; text-decoration: none; vertical-align: baseline; font-size: 14px; font-family: Roboto, "Helvetica Neue", sans-serif; font-weight: 500; color: currentColor; text-align: center; margin: 0; min-width: 88px; line-height: 36px; padding: 0 16px; border-radius: 3px; } .md-primary[md-raised-button], .md-primary[md-fab], .md-primary[md-mini-fab], .md-primary[md-button], .md-primary[md-icon-button] { color: #009688; } .md-accent[md-raised-button], .md-accent[md-fab], .md-accent[md-mini-fab], .md-accent[md-button], .md-accent[md-icon-button] { color: #9c27b0; } .md-warn[md-raised-button], .md-warn[md-fab], .md-warn[md-mini-fab], .md-warn[md-button], .md-warn[md-icon-button] { color: #f44336; } .md-primary[disabled][md-raised-button], .md-primary[disabled][md-fab], .md-primary[disabled][md-mini-fab], .md-primary[disabled][md-button], .md-primary[disabled][md-icon-button], .md-accent[disabled][md-raised-button], .md-accent[disabled][md-fab], .md-accent[disabled][md-mini-fab], .md-accent[disabled][md-button], .md-accent[disabled][md-icon-button], .md-warn[disabled][md-raised-button], .md-warn[disabled][md-fab], .md-warn[disabled][md-mini-fab], .md-warn[disabled][md-button], .md-warn[disabled][md-icon-button], [disabled][disabled][md-raised-button], [disabled][disabled][md-fab], [disabled][disabled][md-mini-fab], [disabled][disabled][md-button], [disabled][disabled][md-icon-button] { color: rgba(0, 0, 0, 0.38); } [disabled][md-raised-button], [disabled][md-fab], [disabled][md-mini-fab], [disabled][md-button], [disabled][md-icon-button] { cursor: default; } .md-button-focus[md-raised-button]::after, .md-button-focus[md-fab]::after, .md-button-focus[md-mini-fab]::after, .md-button-focus[md-button]::after, .md-button-focus[md-icon-button]::after { position: absolute; top: 0; left: 0; bottom: 0; right: 0; content: ''; background-color: rgba(0, 0, 0, 0.12); border-radius: inherit; pointer-events: none; } .md-button-focus.md-primary[md-raised-button]::after, .md-button-focus.md-primary[md-fab]::after, .md-button-focus.md-primary[md-mini-fab]::after, .md-button-focus.md-primary[md-button]::after, .md-button-focus.md-primary[md-icon-button]::after { background-color: rgba(0, 150, 136, 0.12); } .md-button-focus.md-accent[md-raised-button]::after, .md-button-focus.md-accent[md-fab]::after, .md-button-focus.md-accent[md-mini-fab]::after, .md-button-focus.md-accent[md-button]::after, .md-button-focus.md-accent[md-icon-button]::after { background-color: rgba(156, 39, 176, 0.12); } .md-button-focus.md-warn[md-raised-button]::after, .md-button-focus.md-warn[md-fab]::after, .md-button-focus.md-warn[md-mini-fab]::after, .md-button-focus.md-warn[md-button]::after, .md-button-focus.md-warn[md-icon-button]::after { background-color: rgba(244, 67, 54, 0.12); } [md-raised-button], [md-fab], [md-mini-fab] { box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12); background-color: #fafafa; transform: translate3d(0, 0, 0); transition: background 400ms cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1); } .md-primary[md-raised-button], .md-primary[md-fab], .md-primary[md-mini-fab] { color: white; } .md-accent[md-raised-button], .md-accent[md-fab], .md-accent[md-mini-fab] { color: rgba(255, 255, 255, 0.870588); } .md-warn[md-raised-button], .md-warn[md-fab], .md-warn[md-mini-fab] { color: white; } .md-primary[disabled][md-raised-button], .md-primary[disabled][md-fab], .md-primary[disabled][md-mini-fab], .md-accent[disabled][md-raised-button], .md-accent[disabled][md-fab], .md-accent[disabled][md-mini-fab], .md-warn[disabled][md-raised-button], .md-warn[disabled][md-fab], .md-warn[disabled][md-mini-fab], [disabled][disabled][md-raised-button], [disabled][disabled][md-fab], [disabled][disabled][md-mini-fab] { color: rgba(0, 0, 0, 0.38); } .md-primary[md-raised-button], .md-primary[md-fab], .md-primary[md-mini-fab] { background-color: #009688; } .md-accent[md-raised-button], .md-accent[md-fab], .md-accent[md-mini-fab] { background-color: #9c27b0; } .md-warn[md-raised-button], .md-warn[md-fab], .md-warn[md-mini-fab] { background-color: #f44336; } .md-primary[disabled][md-raised-button], .md-primary[disabled][md-fab], .md-primary[disabled][md-mini-fab], .md-accent[disabled][md-raised-button], .md-accent[disabled][md-fab], .md-accent[disabled][md-mini-fab], .md-warn[disabled][md-raised-button], .md-warn[disabled][md-fab], .md-warn[disabled][md-mini-fab], [disabled][disabled][md-raised-button], [disabled][disabled][md-fab], [disabled][disabled][md-mini-fab] { background-color: rgba(0, 0, 0, 0.12); } [md-raised-button]:active, [md-fab]:active, [md-mini-fab]:active { box-shadow: 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12); } [disabled][md-raised-button], [disabled][md-fab], [disabled][md-mini-fab] { box-shadow: none; } [md-button]:hover::after, [md-icon-button]:hover::after { position: absolute; top: 0; left: 0; bottom: 0; right: 0; content: ''; background-color: rgba(0, 0, 0, 0.12); border-radius: inherit; pointer-events: none; } [md-button]:hover.md-primary::after, [md-icon-button]:hover.md-primary::after { background-color: rgba(0, 150, 136, 0.12); } [md-button]:hover.md-accent::after, [md-icon-button]:hover.md-accent::after { background-color: rgba(156, 39, 176, 0.12); } [md-button]:hover.md-warn::after, [md-icon-button]:hover.md-warn::after { background-color: rgba(244, 67, 54, 0.12); } [md-button][disabled]:hover.md-primary, [md-button][disabled]:hover.md-accent, [md-button][disabled]:hover.md-warn, [md-button][disabled]:hover::after, [md-icon-button][disabled]:hover.md-primary, [md-icon-button][disabled]:hover.md-accent, [md-icon-button][disabled]:hover.md-warn, [md-icon-button][disabled]:hover::after { background-color: transparent; } [md-fab] { min-width: 0; border-radius: 50%; background-color: #9c27b0; color: rgba(255, 255, 255, 0.870588); width: 56px; height: 56px; padding: 0; } [md-fab] i, [md-fab] md-icon { padding: 16px 0; } [md-mini-fab] { min-width: 0; border-radius: 50%; background-color: #9c27b0; color: rgba(255, 255, 255, 0.870588); width: 40px; height: 40px; padding: 0; } [md-mini-fab] i, [md-mini-fab] md-icon { padding: 8px 0; } [md-icon-button] { min-width: 0; padding: 0; width: 40px; height: 40px; line-height: 24px; border-radius: 50%; } [md-icon-button] .md-button-wrapper > * { vertical-align: middle; } .md-button-ripple { position: absolute; top: 0; left: 0; bottom: 0; right: 0; } .md-button-ripple-round { border-radius: 50%; z-index: 1; } @media screen and (-ms-high-contrast: active) { .md-raised-button, .md-fab, .md-mini-fab { border: 1px solid #fff; } } /*# sourceMappingURL=button.css.map */ </style><style>.diffbox[_ngcontent-35] {
  border: 1px solid #eee;
  -webkit-text-size-adjust: 100%;
  margin: 1.5em 0;
}
.diffbox[_ngcontent-35]   .title-panel[_ngcontent-35] {
  padding: 5px 12px;
  background: #eee;
  border-bottom: solid 1px #eee;
  color: #333;
  overflow: auto;
  font-size: .875rem;
}
.diffbox[_ngcontent-35]   .title-panel[_ngcontent-35]   .github-commit-link[_ngcontent-35] {
  float: right;
  color: black;
  text-decoration: none;
  border-bottom: none !important;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35] {
  overflow-x: auto;
  position: relative;
  padding: 9px 3px 3px 0;
  background: #f8f8f8;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35]   .scroll-container[_ngcontent-35] {
  display: inline-block;
  min-width: 100%;
  overflow: hidden;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35]:hover    > .improve-code[_ngcontent-35] {
  display: block;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35]   .improve-code[_ngcontent-35] {
  display: none;
  position: absolute;
  bottom: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.5);
  padding: 5px;
  cursor: pointer;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35]   .line-numbers[_ngcontent-35] {
  text-align: right;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -o-user-select: none;
  position: absolute;
  width: 25px;
}
.diffbox[_ngcontent-35]   .code-container[_ngcontent-35]   .line-numbers[_ngcontent-35]   .line-number[_ngcontent-35] {
  color: #aaa;
  font-style: italic;
  margin: 0 !important;
}</style><style>/** The width/height of the icon element. */ /** This works because we're using ViewEncapsulation.None. If we used the default encapsulation, the selector would need to be ":host". */ md-icon { background-repeat: no-repeat; display: inline-block; fill: currentColor; height: 24px; width: 24px; } /*# sourceMappingURL=icon.css.map */ </style></head>

<body style="display: none;">
  <a href="https://github.com/urigo/angular-meteor/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 2000;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

  <app><md-toolbar class="main-toolbar md-primary"><div class="md-toolbar-layout"> <md-toolbar-row> 
  <a class="logo-link" href=""><img class="logo" src="assets/images/logo-large.png"></a>

  <button class="nav-toggle" md-icon-button=""><span class="md-button-wrapper">
    <i class="material-icons">menu</i>
  </span> </button>

  <nav class="nav-links">
    <div class="primary-nav">
      <div class="tutorials-dropdown">
        <button md-button=""><span class="md-button-wrapper"><span class="button-inner">Tutorials<i class="material-icons">arrow_drop_down</i></span>
        </span> </button>
        <div class="dropdown-content">
          <steps-list prefix="tutorials/whatsapp2">
<!--template bindings={}--><ul class="tutorial-steps-list">
    <!--template bindings={}--><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/setup">1. Bootstrapping</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/chats-page">2. Chats page</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/rxjs">3. RxJS</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/meteor-server-side">4. Realtime Meteor Server</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/folder-structure">5. Folder Structure</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/messages-page">6. Messages Page</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/authentication">7. Authentication</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/chats-mutations">8. Chats Creation &amp; Removal</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/privacy">9. Privacy &amp; Security</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/filter-and-pagination">10. Filter &amp; Pagination</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/google-maps">11. Google Maps</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/file-upload">12. File Upload &amp; Images</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/native-mobile">13. Native Mobile</a>
    </li><li class="step-item">
        <a class="step-link" href="tutorials/whatsapp2/ionic/summary">14. Summary</a>
    </li>
    <!--template bindings={}--><li class="step-item extra-item">
        <a class="step-link extra-link bold" className="step-link extra-link bold" href="tutorials/whatsapp2-tutorial">WhatsApp clone with Angular &amp; Meteor</a>
    </li><li class="step-item extra-item">
        <a class="step-link extra-link bold" className="step-link extra-link bold" href="tutorials/migration/angular2/introduction">Blaze to Angular 2 Migration tutorial</a>
    </li><li class="step-item extra-item">
        <a class="step-link extra-link bold" className="step-link extra-link bold" href="tutorials/socially/angular2/bootstrap">Old Socially Tutorials</a>
    </li><li class="step-item extra-item">
        <a class="step-link extra-link bold" className="step-link extra-link bold" href="training">Custom Training</a>
    </li>
</ul></steps-list>
        </div>
      </div>
      <a href="api/angular2-meteor/latest/Meteor-RxJS">
        <button md-button=""><span class="md-button-wrapper">API Reference</span> </button>
      </a>
      <a href="meteor-rxjs">
        <button md-button=""><span class="md-button-wrapper">Meteor+RxJS</span> </button>
      </a>
    </div>
    <div class="secondary-nav">
      <a href="http://info.meteor.com/blog/author/uri-goldshtein?__hstc=219992390.b4a81f3b906b078dac633307097097f5.1471207723059.1471890076881.1471938647239.7&amp;__hssc=219992390.3.1471938647239&amp;__hsfp=714783454" target="_blank">
        <button md-button=""><span class="md-button-wrapper">Blog</span> </button>
      </a>
      <a class="support-link" href="support">
        <button md-button=""><span class="md-button-wrapper">Support</span> </button>
        
      </a>
      <a href="consulting">
        <button md-button=""><span class="md-button-wrapper">Consulting</span> </button>
      </a>
      <a href="manifesto">
        <button md-button=""><span class="md-button-wrapper">Manifesto</span> </button>
      </a>
    </div>
  </nav>
 </md-toolbar-row>  </div></md-toolbar>
<router-outlet></router-outlet><tutorial><div class="tutorials-container">
  <!--template bindings={}--><div class="tutorial-title">
    <h1>WhatsApp Clone with Ionic 2 and Meteor CLI</h1>
    <h5 class="gh-link"><a target="_blank" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp"><md-icon fontIcon="fa-github" fontSet="fa" role="img" class="fa fa-github" aria-label="fa-github"></md-icon>https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp</a></h5>
    <!--template bindings={}--><h4>Socially Merge Version (Last Update: 14.02.2017)</h4>
  </div>
  <!--template bindings={}-->
  <!--template bindings={}--><div class="version-timeline">
    <div class="bar"></div>
    <div class="timeline">
      <!--template bindings={}--><div class="entry " className="entry ">
        <!--template bindings={}--><a href="/tutorials/whatsapp2/meteor/1.0.0/setup">
          <h1>Legacy Tutorial</h1>
          <h4>22.11.2016</h4>
        </a>
        <!--template bindings={}-->
      </div><div class="entry current-version" className="entry current-version">
        <!--template bindings={}--><a href="/tutorials/whatsapp2/meteor/setup">
          <h1>Socially Merge</h1>
          <h4>14.02.2017</h4>
        </a>
        <!--template bindings={}-->
      </div>
    </div>
  </div>
  <div class="tutorial-inner-container">
    <nav class="side-nav l-pinned-left l-layer-4 l-offset-nav">
      <tutorials-versions><!--template bindings={}--><a md-raised-button="" class="tutorial-version tutorial-button md-primary active" className="tutorial-version tutorial-button md-primary active" href="/tutorials/whatsapp2/meteor/file-upload" aria-disabled="false"><span class="md-button-wrapper">Meteor</span> </a><a md-raised-button="" class="tutorial-version tutorial-button md-primary " className="tutorial-version tutorial-button md-primary " href="/tutorials/whatsapp2/ionic/file-upload" aria-disabled="false"><span class="md-button-wrapper">Webpack</span> </a>
</tutorials-versions>
      <steps-list>
<!--template bindings={}--><ul class="tutorial-steps-list">
    <!--template bindings={}--><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/setup">1. Bootstrapping</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/chats-page">2. Chats page</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/rxjs">3. RxJS</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/meteor-server-side">4. Realtime Meteor Server</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/folder-structure">5. Folder Structure</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/messages-page">6. Messages Page</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/authentication">7. Authentication</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/chats-mutations">8. Chats Creation &amp; Removal</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/privacy">9. Privacy &amp; Security</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/filter-and-pagination">10. Filter &amp; Pagination</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/google-maps">11. Google Maps</a>
    </li><li class="step-item active-step">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/file-upload">12. File Upload &amp; Images</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/native-mobile">13. Native Mobile</a>
    </li><li class="step-item">
        <a class="step-link" href="/tutorials/whatsapp2/meteor/summary">14. Summary</a>
    </li>
    <!--template bindings={}-->
</ul></steps-list>
    </nav>
    <div class="tutorial-content">
      <div class="top-navigation">
        <div class="tutorial-nav">
          <a class="md-primary tutorial-button" md-raised-button="" tutorialNavigation="previous" aria-disabled="false" href="/tutorials/whatsapp2/meteor/google-maps"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">navigate_before</i>Previous</span>
          </span> </a>
          <a class="md-primary tutorial-button" codeDiffLink="" md-raised-button="" aria-disabled="false" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/compare/step11...step12"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">search</i>Code Diff</span>
          </span> </a>
          <a class="md-primary tutorial-button" md-raised-button="" tutorialNavigation="next" aria-disabled="false" href="/tutorials/whatsapp2/meteor/native-mobile"><span class="md-button-wrapper">
            <span class="button-wrapper right-icon">Next<i class="material-icons">navigate_next</i></span>
          </span> </a>
        </div>

        <div class="improve">
          <a class="md-primary improv-button tutorial-button" md-raised-button="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/templates/step12.md" aria-disabled="false"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">mode_edit</i>Improve This Tutorial</span>
          </span> </a>
        </div>
      </div>
      <h1 class="tutorial-title" stepName="">File Upload &amp; Images</h1>
      <a class="zip-download" stepDownloadZip="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/archive/step11.zip">
        Note: If you skipped ahead to this section, click here to download a zip of the tutorial at this point.
      </a>
      <!--template bindings={}-->
      <router-outlet></router-outlet><tutorial-page><div class="tutorial-container"></div></tutorial-page><tutorial-container><p>In this step, we will be using <code>Ionic 2</code> to pick up some images from our device's gallery, and we will use them to send pictures, and to set our profile picture.</p>
<h2 id="image-picker">Image Picker</h2>
<p>First, we will a <code>Cordova</code> plug-in which will give us the ability to access the gallery:</p>
<pre><code>$ meteor add cordova:cordova-plugin-image-picker@1.1.3
</code></pre><h2 id="meteor-fs">Meteor FS</h2>
<p>Up next, would be adding the ability to store some files in our data-base. This requires us to add 2 <code>Meteor</code> packages, called <code>ufs</code> and <code>ufs-gridfs</code> (Which adds support for <code>GridFS</code> operations. See <a href="https://docs.mongodb.com/manual/core/gridfs/">reference</a>), which will take care of FS operations:</p>
<pre><code>$ meteor add jalik:ufs
$ meteor add jalik:ufs-gridfs
</code></pre><h2 id="client-side">Client Side</h2>
<p>Before we proceed to the server, we will add the ability to select and upload pictures in the client. All our picture-related operations will be defined in a single service called <code>PictureService</code>; The first bit of this service would be picture-selection. The <code>UploadFS</code> package already supports that feature, <strong>but only for the browser</strong>, therefore we will be using the <code>Cordova</code> plug-in we've just installed to select some pictures from our mobile device:</p>
<diffbox step="12.3" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.3</span> <span _ngcontent-35="" class="commit-summary">Create PictureService with utils for files</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/b02ac43a70a82dfe68d7706cd3d532c4af8fc177">client/imports/services/picture.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre><pre _ngcontent-35="" class="line-number">44</pre><pre _ngcontent-35="" class="line-number">45</pre><pre _ngcontent-35="" class="line-number">46</pre><pre _ngcontent-35="" class="line-number">47</pre><pre _ngcontent-35="" class="line-number">48</pre><pre _ngcontent-35="" class="line-number">49</pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre><pre _ngcontent-35="" class="line-number">57</pre><pre _ngcontent-35="" class="line-number">58</pre><pre _ngcontent-35="" class="line-number">59</pre><pre _ngcontent-35="" class="line-number">60</pre><pre _ngcontent-35="" class="line-number">61</pre><pre _ngcontent-35="" class="line-number">62</pre><pre _ngcontent-35="" class="line-number">63</pre><pre _ngcontent-35="" class="line-number">64</pre><pre _ngcontent-35="" class="line-number">65</pre><pre _ngcontent-35="" class="line-number">66</pre><pre _ngcontent-35="" class="line-number">67</pre><pre _ngcontent-35="" class="line-number">68</pre><pre _ngcontent-35="" class="line-number">69</pre><pre _ngcontent-35="" class="line-number">70</pre><pre _ngcontent-35="" class="line-number">71</pre><pre _ngcontent-35="" class="line-number">72</pre><pre _ngcontent-35="" class="line-number">73</pre><pre _ngcontent-35="" class="line-number">74</pre><pre _ngcontent-35="" class="line-number">75</pre><pre _ngcontent-35="" class="line-number">76</pre><pre _ngcontent-35="" class="line-number">77</pre><pre _ngcontent-35="" class="line-number">78</pre><pre _ngcontent-35="" class="line-number">79</pre><pre _ngcontent-35="" class="line-number">80</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Injectable <span>}</span> from <span class="hljs-string">'@angular/core'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Platform <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> ImagePicker <span>}</span> from <span class="hljs-string">'ionic-native'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> UploadFS <span>}</span> from <span class="hljs-string">'meteor/jalik:ufs'</span>;</pre><pre class="line-added"> </pre><pre class="line-added">@Injectable()</pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> PictureService <span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">constructor</span>(private platform: Platform) <span>{</span></pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  select(): Promise&lt;Blob&gt; <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.platform.is(<span class="hljs-string">'cordova'</span>) || !<span class="hljs-keyword">this</span>.platform.is(<span class="hljs-string">'mobile'</span>)) <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise((resolve, reject) =&gt; <span>{</span></pre><pre class="line-added">        <span class="hljs-keyword">try</span> <span>{</span></pre><pre class="line-added">          UploadFS.selectFile((file: File) =&gt; <span>{</span></pre><pre class="line-added">            resolve(file);</pre><pre class="line-added">          <span>}</span>);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-added">        <span class="hljs-keyword">catch</span> (e) <span>{</span></pre><pre class="line-added">          reject(e);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-added">      <span>}</span>);</pre><pre class="line-added">    <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-keyword">return</span> ImagePicker.getPictures(<span>{</span>maximumImagesCount: <span class="hljs-number">1</span><span>}</span>).then((URL: <span class="hljs-built_in">string</span>) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.convertURLtoBlob(URL);</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  convertURLtoBlob(URL: <span class="hljs-built_in">string</span>): Promise&lt;Blob&gt; <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise((resolve, reject) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">const</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>);</pre><pre class="line-added"> </pre><pre class="line-added">      image.onload = () =&gt; <span>{</span></pre><pre class="line-added">        <span class="hljs-keyword">try</span> <span>{</span></pre><pre class="line-added">          <span class="hljs-keyword">const</span> dataURI = <span class="hljs-keyword">this</span>.convertImageToDataURI(image);</pre><pre class="line-added">          <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">this</span>.convertDataURIToBlob(dataURI);</pre><pre class="line-added"> </pre><pre class="line-added">          resolve(blob);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-added">        <span class="hljs-keyword">catch</span> (e) <span>{</span></pre><pre class="line-added">          reject(e);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-added">      <span>}</span>;</pre><pre class="line-added"> </pre><pre class="line-added">      image.src = URL;</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  convertImageToDataURI(image: HTMLImageElement): <span class="hljs-built_in">string</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-comment">// Create an empty canvas element</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> canvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>);</pre><pre class="line-added">    canvas.width = image.width;</pre><pre class="line-added">    canvas.height = image.height;</pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-comment">// Copy the image contents to the canvas</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> context = canvas.getContext(<span class="hljs-string">'2d'</span>);</pre><pre class="line-added">    context.drawImage(image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-comment">// Get the data-URL formatted image</span></pre><pre class="line-added">    <span class="hljs-comment">// Firefox supports PNG and JPEG. You could check image.src to</span></pre><pre class="line-added">    <span class="hljs-comment">// guess the original format, but be aware the using 'image/jpg'</span></pre><pre class="line-added">    <span class="hljs-comment">// will re-encode the image.</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> dataURL = canvas.toDataURL(<span class="hljs-string">'image/png'</span>);</pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-keyword">return</span> dataURL.replace(<span class="hljs-regexp">/^data:image\/(png|jpg);base64,/</span>, <span class="hljs-string">''</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  convertDataURIToBlob(dataURI): Blob <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> binary = atob(dataURI);</pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-comment">// Write the bytes of the string to a typed array</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> charCodes = <span class="hljs-built_in">Object</span>.keys(binary)</pre><pre class="line-added">      .map&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-built_in">Number</span>)</pre><pre class="line-added">      .map&lt;<span class="hljs-built_in">number</span>&gt;(binary.charCodeAt.bind(binary));</pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-comment">// Build blob with typed array</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Blob([<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(charCodes)], <span>{</span><span class="hljs-keyword">type</span>: <span class="hljs-string">'image/jpeg'</span><span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L30">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>In order to use the service we will need to import it in the app's <code>NgModule</code> as a <code>provider</code>:</p>
<diffbox step="12.4" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.4</span> <span _ngcontent-35="" class="commit-summary">Import PictureService</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/683ef87c9e9704ea4c8d1a57fb344cb003f322cf">client/imports/app/app.module.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre><pre _ngcontent-35="" class="line-number">57</pre><pre _ngcontent-35="" class="line-number">58</pre><pre _ngcontent-35="" class="line-number">59</pre><pre _ngcontent-35="" class="line-number">60</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> ProfilePage <span>}</span> from <span class="hljs-string">'../pages/profile/profile'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> VerificationPage <span>}</span> from <span class="hljs-string">'../pages/verification/verification'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> PhoneService <span>}</span> from <span class="hljs-string">'../services/phone'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> PictureService <span>}</span> from <span class="hljs-string">'../services/picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MyApp <span>}</span> from <span class="hljs-string">'./app.component'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">@NgModule(<span>{</span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">  ],</pre><pre class="line-context">  providers: [</pre><pre class="line-context">    <span>{</span> provide: ErrorHandler, useClass: IonicErrorHandler <span>}</span>,</pre><pre class="line-added">    PhoneService,</pre><pre class="line-added">    PictureService</pre><pre class="line-context">  ]</pre><pre class="line-context"><span>}</span>)</pre><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> AppModule <span>{</span><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L121">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Since now we will be sending pictures, we will need to update the message schema to support picture typed messages:</p>
<diffbox step="12.5" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.5</span> <span _ngcontent-35="" class="commit-summary">Added picture message type</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/5449204e033aff89589253940009a0f27b610a95">imports/models.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"> </pre><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> MessageType <span>{</span></pre><pre class="line-context">  TEXT = &lt;<span class="hljs-built_in">any</span>&gt;<span class="hljs-string">'text'</span>,</pre><pre class="line-added">  LOCATION = &lt;<span class="hljs-built_in">any</span>&gt;<span class="hljs-string">'location'</span>,</pre><pre class="line-added">  PICTURE = &lt;<span class="hljs-built_in">any</span>&gt;<span class="hljs-string">'picture'</span></pre><pre class="line-context"><span>}</span></pre><pre class="line-context"> </pre><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Chat <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L151">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>In the attachments menu, we will add a new handler for sending pictures, called <code>sendPicture</code>:</p>
<diffbox step="12.6" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.6</span> <span _ngcontent-35="" class="commit-summary">Implement sendPicture method</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/46cd93f98750d9d5efa2bd641b64c97141123f70">client/imports/pages/messages/messages-attachments.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Component <span>}</span> from <span class="hljs-string">'@angular/core'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> AlertController, Platform, ModalController, ViewController <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> PictureService <span>}</span> from <span class="hljs-string">'../../services/picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessageType <span>}</span> from <span class="hljs-string">'../../../../imports/models'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> NewLocationMessageComponent <span>}</span> from <span class="hljs-string">'./location-message'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./messages-attachments.html'</span>;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">    <span class="hljs-keyword">private</span> alertCtrl: AlertController,</pre><pre class="line-context">    <span class="hljs-keyword">private</span> platform: Platform,</pre><pre class="line-context">    <span class="hljs-keyword">private</span> viewCtrl: ViewController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> modelCtrl: ModalController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> pictureService: PictureService</pre><pre class="line-context">  ) <span>{</span><span>}</span></pre><pre class="line-context"> </pre><pre class="line-added">  sendPicture(): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">this</span>.pictureService.select().then((file: File) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">this</span>.viewCtrl.dismiss(<span>{</span></pre><pre class="line-added">        messageType: MessageType.PICTURE,</pre><pre class="line-added">        selectedPicture: file</pre><pre class="line-added">      <span>}</span>);</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-context">  sendLocation(): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">const</span> locationModal = <span class="hljs-keyword">this</span>.modelCtrl.create(NewLocationMessageComponent);</pre><pre class="line-context">    locationModal.onDidDismiss((location) =&gt; <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L171">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>And we will bind that handler to the view, so whenever we press the right button, the handler will be invoked with the selected picture:</p>
<diffbox step="12.7" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.7</span> <span _ngcontent-35="" class="commit-summary">Bind click event for sendPicture</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/40ce1cb54efcf3541c27fac7826e090d78d96ea0">client/imports/pages/messages/messages-attachments.html</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-tag">&lt;<span class="hljs-name">ion-content</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"messages-attachments-page-content"</span>&gt;</span></pre><pre class="line-context">  <span class="hljs-tag">&lt;<span class="hljs-name">ion-list</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attachments"</span>&gt;</span></pre><pre class="line-added">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ion-item</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attachment attachment-gallery"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"sendPicture()"</span>&gt;</span></pre><pre class="line-context">      <span class="hljs-tag">&lt;<span class="hljs-name">ion-icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"images"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attachment-icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ion-icon</span>&gt;</span></pre><pre class="line-context">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attachment-name"</span>&gt;</span>Gallery<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></pre><pre class="line-context">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L211">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Now we will be extending the <code>MessagesPage</code>, by adding a method which will send the picture selected in the attachments menu:</p>
<diffbox step="12.8" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.8</span> <span _ngcontent-35="" class="commit-summary">Implement the actual send of picture message</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/2e7b2a3ef1239fc7f146fa97dee37d6ab67b0630">client/imports/pages/messages/messages.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">238</pre><pre _ngcontent-35="" class="line-number">239</pre><pre _ngcontent-35="" class="line-number">240</pre><pre _ngcontent-35="" class="line-number">241</pre><pre _ngcontent-35="" class="line-number">242</pre><pre _ngcontent-35="" class="line-number">243</pre><pre _ngcontent-35="" class="line-number">244</pre><pre _ngcontent-35="" class="line-number">245</pre><pre _ngcontent-35="" class="line-number">246</pre><pre _ngcontent-35="" class="line-number">247</pre><pre _ngcontent-35="" class="line-number">248</pre><pre _ngcontent-35="" class="line-number">249</pre><pre _ngcontent-35="" class="line-number">250</pre><pre _ngcontent-35="" class="line-number">251</pre><pre _ngcontent-35="" class="line-number">252</pre><pre _ngcontent-35="" class="line-number">253</pre><pre _ngcontent-35="" class="line-number">254</pre><pre _ngcontent-35="" class="line-number">255</pre><pre _ngcontent-35="" class="line-number">256</pre><pre _ngcontent-35="" class="line-number">257</pre><pre _ngcontent-35="" class="line-number">258</pre><pre _ngcontent-35="" class="line-number">259</pre><pre _ngcontent-35="" class="line-number">260</pre><pre _ngcontent-35="" class="line-number">261</pre><pre _ngcontent-35="" class="line-number">262</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Observable, Subscription, Subscriber <span>}</span> from <span class="hljs-string">'rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Messages <span>}</span> from <span class="hljs-string">'../../../../imports/collections'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Chat, Message, MessageType, Location <span>}</span> from <span class="hljs-string">'../../../../imports/models'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> PictureService <span>}</span> from <span class="hljs-string">'../../services/picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesAttachmentsComponent <span>}</span> from <span class="hljs-string">'./messages-attachments'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesOptionsComponent <span>}</span> from <span class="hljs-string">'./messages-options'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./messages.html'</span>;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">  <span class="hljs-keyword">constructor</span>(</pre><pre class="line-context">    navParams: NavParams,</pre><pre class="line-context">    <span class="hljs-keyword">private</span> el: ElementRef,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> popoverCtrl: PopoverController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> pictureService: PictureService</pre><pre class="line-context">  ) <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">this</span>.selectedChat = &lt;Chat&gt;navParams.get(<span class="hljs-string">'chat'</span>);</pre><pre class="line-context">    <span class="hljs-keyword">this</span>.title = <span class="hljs-keyword">this</span>.selectedChat.title;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">          <span class="hljs-keyword">const</span> location = params.selectedLocation;</pre><pre class="line-context">          <span class="hljs-keyword">this</span>.sendLocationMessage(location);</pre><pre class="line-context">        <span>}</span></pre><pre class="line-added">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (params.messageType === MessageType.PICTURE) <span>{</span></pre><pre class="line-added">          <span class="hljs-keyword">const</span> blob: Blob = params.selectedPicture;</pre><pre class="line-added">          <span class="hljs-keyword">this</span>.sendPictureMessage(blob);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-context">      <span>}</span></pre><pre class="line-context">    <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-context">    popover.present();</pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-added">  sendPictureMessage(blob: Blob): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">this</span>.pictureService.upload(blob).then((picture) =&gt; <span>{</span></pre><pre class="line-added">      MeteorObservable.call(<span class="hljs-string">'addMessage'</span>, MessageType.PICTURE,</pre><pre class="line-added">        <span class="hljs-keyword">this</span>.selectedChat._id,</pre><pre class="line-added">        picture.url</pre><pre class="line-added">      ).zone().subscribe();</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-context">  getLocation(locationString: <span class="hljs-built_in">string</span>): Location <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">const</span> splitted = locationString.split(<span class="hljs-string">','</span>).map(<span class="hljs-built_in">Number</span>);</pre><pre class="line-context"> </pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L229">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>For now, we will add a stub for the <code>upload</code> method in the <code>PictureService</code> and we will get back to it once we finish implementing the necessary logic in the server for storing a picture:</p>
<diffbox step="12.9" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.9</span> <span _ngcontent-35="" class="commit-summary">Create stub method for upload method</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/11fb301550c5c75c1f3fae39d65eb1d0f267f46d">client/imports/services/picture.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">    <span>}</span>);</pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-added">  upload(blob: Blob): Promise&lt;<span class="hljs-built_in">any</span>&gt; <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span> Promise.resolve();</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-context">  convertURLtoBlob(URL: <span class="hljs-built_in">string</span>): Promise&lt;Blob&gt; <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise((resolve, reject) =&gt; <span>{</span></pre><pre class="line-context">      <span class="hljs-keyword">const</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>);</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L286">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<h2 id="server-side">Server Side</h2>
<p>So as we said, need to handle storage of pictures that were sent by the client. First, we will create a <code>Picture</code> model so the compiler can recognize a picture object:</p>
<diffbox step="12.10" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.10</span> <span _ngcontent-35="" class="commit-summary">Create Picture model</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/b223c56a61815099d490b705e68222101008b6a1">imports/models.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre><pre _ngcontent-35="" class="line-number">44</pre><pre _ngcontent-35="" class="line-number">45</pre><pre _ngcontent-35="" class="line-number">46</pre><pre _ngcontent-35="" class="line-number">47</pre><pre _ngcontent-35="" class="line-number">48</pre><pre _ngcontent-35="" class="line-number">49</pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre><pre _ngcontent-35="" class="line-number">57</pre><pre _ngcontent-35="" class="line-number">58</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">  lng: <span class="hljs-built_in">number</span>;</pre><pre class="line-context">  zoom: <span class="hljs-built_in">number</span>;</pre><pre class="line-context"><span>}</span></pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Picture <span>{</span></pre><pre class="line-added">  _id?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  complete?: <span class="hljs-built_in">boolean</span>;</pre><pre class="line-added">  extension?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  name?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  progress?: <span class="hljs-built_in">number</span>;</pre><pre class="line-added">  size?: <span class="hljs-built_in">number</span>;</pre><pre class="line-added">  store?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  token?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  <span class="hljs-keyword">type</span>?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  uploadedAt?: <span class="hljs-built_in">Date</span>;</pre><pre class="line-added">  uploading?: <span class="hljs-built_in">boolean</span>;</pre><pre class="line-added">  url?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  userId?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L309">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>If you're familiar with <code>Whatsapp</code>, you'll know that sent pictures are compressed. That's so the data-base can store more pictures, and the traffic in the network will be faster. To compress the sent pictures, we will be using an <code>NPM</code> package called <a href="https://www.npmjs.com/package/sharp">sharp</a>, which is a utility library which will help us perform transformations on pictures:</p>
<pre><code>$ meteor npm install --save sharp
</code></pre><p>Now we will create a picture store which will compress pictures using <code>sharp</code> right before they are inserted into the data-base:</p>
<diffbox step="12.12" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.12</span> <span _ngcontent-35="" class="commit-summary">Create pictures store</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/bc4eb93fd0cb4049037be76bebc284da55964986">imports/collections/pictures.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> MongoObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> UploadFS <span>}</span> from <span class="hljs-string">'meteor/jalik:ufs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Meteor <span>}</span> from <span class="hljs-string">'meteor/meteor'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Picture, DEFAULT_PICTURE_URL <span>}</span> from <span class="hljs-string">'../models'</span>;</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> PicturesCollection&lt;T&gt; <span class="hljs-keyword">extends</span> MongoObservable.Collection&lt;T&gt; <span>{</span></pre><pre class="line-added">  getPictureUrl(selector?: <span class="hljs-built_in">Object</span> | <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;</pre><pre class="line-added"><span>}</span></pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Pictures =</pre><pre class="line-added">  <span class="hljs-keyword">new</span> MongoObservable.Collection&lt;Picture&gt;(<span class="hljs-string">'pictures'</span>) as PicturesCollection&lt;Picture&gt;;</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PicturesStore = <span class="hljs-keyword">new</span> UploadFS.store.GridFS(<span>{</span></pre><pre class="line-added">  collection: Pictures.collection,</pre><pre class="line-added">  name: <span class="hljs-string">'pictures'</span>,</pre><pre class="line-added">  filter: <span class="hljs-keyword">new</span> UploadFS.Filter(<span>{</span></pre><pre class="line-added">    contentTypes: [<span class="hljs-string">'image/*'</span>]</pre><pre class="line-added">  <span>}</span>),</pre><pre class="line-added">  permissions: <span class="hljs-keyword">new</span> UploadFS.StorePermissions(<span>{</span></pre><pre class="line-added">    insert: picturesPermissions,</pre><pre class="line-added">    update: picturesPermissions,</pre><pre class="line-added">    remove: picturesPermissions</pre><pre class="line-added">  <span>}</span>),</pre><pre class="line-added">  transformWrite(from, to) <span>{</span></pre><pre class="line-added">    <span class="hljs-comment">// The transformation function will only be invoked on the server. Accordingly,</span></pre><pre class="line-added">    <span class="hljs-comment">// the 'sharp' library is a server-only library which will cause an error to be</span></pre><pre class="line-added">    <span class="hljs-comment">// thrown when loaded on the global scope</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> Sharp = Npm.require(<span class="hljs-string">'sharp'</span>);</pre><pre class="line-added">    <span class="hljs-comment">// Compress picture to 75% from its original quality</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> transform = Sharp().png(<span>{</span> quality: <span class="hljs-number">75</span> <span>}</span>);</pre><pre class="line-added">    from.pipe(transform).pipe(to);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"><span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-comment">// Gets picture's url by a given selector</span></pre><pre class="line-added">Pictures.getPictureUrl = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">selector</span>) </span><span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">const</span> picture = <span class="hljs-keyword">this</span>.findOne(selector) || <span>{</span><span>}</span>;</pre><pre class="line-added">  <span class="hljs-keyword">return</span> picture.url || DEFAULT_PICTURE_URL;</pre><pre class="line-added"><span>}</span>;</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">picturesPermissions</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>): <span class="hljs-title">boolean</span> </span><span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">return</span> Meteor.isServer || !!userId;</pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L343">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>You can look at a store as some sort of a wrapper for a collection, which will run different kind of a operations before it mutates it or fetches data from it. Note that we used <code>GridFS</code> because this way an uploaded file is split into multiple packets, which is more efficient for storage. We also defined a small utility function on that store which will retrieve a profile picture. If the ID was not found, it will return a link for the default picture. To make things convenient, we will also export the store from the <code>index</code> file:</p>
<diffbox step="12.13" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.13</span> <span _ngcontent-35="" class="commit-summary">Export pictures collection</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/f7ab52441fa1f499a90be370b4b1856fed0de708">imports/collections/index.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">export</span> * from <span class="hljs-string">'./chats'</span>;</pre><pre class="line-context"><span class="hljs-keyword">export</span> * from <span class="hljs-string">'./messages'</span>;</pre><pre class="line-added"><span class="hljs-keyword">export</span> * from <span class="hljs-string">'./pictures'</span>;</pre><pre class="line-added"><span class="hljs-keyword">export</span> * from <span class="hljs-string">'./users'</span>;</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L397">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Now that we have the pictures store, and the server knows how to handle uploaded pictures, we will implement the <code>upload</code> stub in the <code>PictureService</code>:</p>
<diffbox step="12.14" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.14</span> <span _ngcontent-35="" class="commit-summary">Implement upload method</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/201121c5d28352796ba8dc02f5dfc88892a3a4c1">client/imports/services/picture.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre><pre _ngcontent-35="" class="line-number">44</pre><pre _ngcontent-35="" class="line-number">45</pre><pre _ngcontent-35="" class="line-number">46</pre><pre _ngcontent-35="" class="line-number">47</pre><pre _ngcontent-35="" class="line-number">48</pre><pre _ngcontent-35="" class="line-number">49</pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Platform <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> ImagePicker <span>}</span> from <span class="hljs-string">'ionic-native'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> UploadFS <span>}</span> from <span class="hljs-string">'meteor/jalik:ufs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> _ <span>}</span> from <span class="hljs-string">'meteor/underscore'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> PicturesStore <span>}</span> from <span class="hljs-string">'../../../imports/collections'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> DEFAULT_PICTURE_URL <span>}</span> from <span class="hljs-string">'../../../imports/models'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">@Injectable()</pre><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> PictureService <span>{</span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-context">  upload(blob: Blob): Promise&lt;<span class="hljs-built_in">any</span>&gt; <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Promise((resolve, reject) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">const</span> metadata = _.pick(blob, <span class="hljs-string">'name'</span>, <span class="hljs-string">'type'</span>, <span class="hljs-string">'size'</span>);</pre><pre class="line-added"> </pre><pre class="line-added">      <span class="hljs-keyword">if</span> (!metadata.name) <span>{</span></pre><pre class="line-added">        metadata.name = DEFAULT_PICTURE_URL;</pre><pre class="line-added">      <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">      <span class="hljs-keyword">const</span> upload = <span class="hljs-keyword">new</span> UploadFS.Uploader(<span>{</span></pre><pre class="line-added">        data: blob,</pre><pre class="line-added">        file: metadata,</pre><pre class="line-added">        store: PicturesStore,</pre><pre class="line-added">        onComplete: resolve,</pre><pre class="line-added">        onError: reject</pre><pre class="line-added">      <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-added">      upload.start();</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-context">  convertURLtoBlob(URL: <span class="hljs-built_in">string</span>): Promise&lt;Blob&gt; <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L413">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<h2 id="view-picture-messages">View Picture Messages</h2>
<p>We will now add the support for picture typed messages in the <code>MessagesPage</code>, so whenever we send a picture, we will be able to see them in the messages list like any other message:</p>
<diffbox step="12.15" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.15</span> <span _ngcontent-35="" class="commit-summary">Added view for picture message</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/12fbd5a8278286e1ff791a2b2c12e798bfad9d75">client/imports/pages/messages/messages.html</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">              <span class="hljs-tag">&lt;<span class="hljs-name">sebm-google-map-marker</span> [<span class="hljs-attr">latitude</span>]=<span class="hljs-string">"getLocation(message.content).lat"</span> [<span class="hljs-attr">longitude</span>]=<span class="hljs-string">"getLocation(message.content).lng"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sebm-google-map-marker</span>&gt;</span></pre><pre class="line-context">            <span class="hljs-tag">&lt;/<span class="hljs-name">sebm-google-map</span>&gt;</span></pre><pre class="line-context">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></pre><pre class="line-added">          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"message.type == 'picture'"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"showPicture($event)"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message-content message-content-picture"</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">"message.content"</span>&gt;</span></pre><pre class="line-context"> </pre><pre class="line-context">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message-timestamp"</span>&gt;</span><span>{</span><span>{</span> message.createdAt | amDateFormat: 'HH:mm' <span>}</span><span>}</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></pre><pre class="line-context">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L462">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>As you can see, we also bound the picture message to the <code>click</code> event, which means that whenever we click on it, a picture viewer should be opened with the clicked picture. Let's create the component for that picture viewer:</p>
<diffbox step="12.16" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.16</span> <span _ngcontent-35="" class="commit-summary">Create show picture component</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/bab7afccc96ee295dc29506e7766a59434a4b27e">client/imports/pages/messages/show-picture.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Component <span>}</span> from <span class="hljs-string">'@angular/core'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> NavParams, ViewController <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./show-picture.html'</span>;</pre><pre class="line-added"> </pre><pre class="line-added">@Component(<span>{</span></pre><pre class="line-added">  template</pre><pre class="line-added"><span>}</span>)</pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> ShowPictureComponent <span>{</span></pre><pre class="line-added">  pictureSrc: <span class="hljs-built_in">string</span>;</pre><pre class="line-added"> </pre><pre class="line-added">  <span class="hljs-keyword">constructor</span>(private navParams: NavParams, private viewCtrl: ViewController) <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">this</span>.pictureSrc = navParams.get(<span class="hljs-string">'pictureSrc'</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L480">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<diffbox step="12.17" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.17</span> <span _ngcontent-35="" class="commit-summary">Create show picture template</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/30f1ffe1c8bef641a9fbf4efed7ffe45af1ca2ef">client/imports/pages/messages/show-picture.html</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-added"><span class="hljs-tag">&lt;<span class="hljs-name">ion-header</span>&gt;</span></pre><pre class="line-added">  <span class="hljs-tag">&lt;<span class="hljs-name">ion-toolbar</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"whatsapp"</span>&gt;</span></pre><pre class="line-added">    <span class="hljs-tag">&lt;<span class="hljs-name">ion-title</span>&gt;</span>Show Picture<span class="hljs-tag">&lt;/<span class="hljs-name">ion-title</span>&gt;</span></pre><pre class="line-added"> </pre><pre class="line-added">    <span class="hljs-tag">&lt;<span class="hljs-name">ion-buttons</span> <span class="hljs-attr">left</span>&gt;</span></pre><pre class="line-added">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ion-button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dismiss-button"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"viewCtrl.dismiss()"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ion-icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"close"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ion-icon</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></pre><pre class="line-added">    <span class="hljs-tag">&lt;/<span class="hljs-name">ion-buttons</span>&gt;</span></pre><pre class="line-added">  <span class="hljs-tag">&lt;/<span class="hljs-name">ion-toolbar</span>&gt;</span></pre><pre class="line-added"><span class="hljs-tag">&lt;/<span class="hljs-name">ion-header</span>&gt;</span></pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-tag">&lt;<span class="hljs-name">ion-content</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"show-picture"</span>&gt;</span></pre><pre class="line-added">  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picture"</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">"pictureSrc"</span>&gt;</span></pre><pre class="line-added"><span class="hljs-tag">&lt;/<span class="hljs-name">ion-content</span>&gt;</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L503">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<diffbox step="12.18" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.18</span> <span _ngcontent-35="" class="commit-summary">Create show pictuer component styles</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/83667b4ad589f098f56fae592790eef9313e1c1e">client/imports/pages/messages/show-picture.scss</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-added"><span class="hljs-selector-class">.show-picture</span> <span>{</span></pre><pre class="line-added">  <span class="hljs-attribute">background-color</span>: black;</pre><pre class="line-added"> </pre><pre class="line-added">  <span class="hljs-selector-class">.picture</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-attribute">position</span>: absolute;</pre><pre class="line-added">    <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;</pre><pre class="line-added">    <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;</pre><pre class="line-added">    <span class="hljs-attribute">transform</span>: translate(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L525">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<diffbox step="12.19" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.19</span> <span _ngcontent-35="" class="commit-summary">Import ShowPictureComponent</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/bf7ab1a0dc641555dea2c2acced48e217dbb902b">client/imports/app/app.module.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre><pre _ngcontent-35="" class="line-number">57</pre><pre _ngcontent-35="" class="line-number">58</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesAttachmentsComponent <span>}</span> from <span class="hljs-string">'../pages/messages/messages-attachments'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesOptionsComponent <span>}</span> from <span class="hljs-string">'../pages/messages/messages-options'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> NewLocationMessageComponent <span>}</span> from <span class="hljs-string">'../pages/messages/location-message'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> ShowPictureComponent <span>}</span> from <span class="hljs-string">'../pages/messages/show-picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> ProfilePage <span>}</span> from <span class="hljs-string">'../pages/profile/profile'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> VerificationPage <span>}</span> from <span class="hljs-string">'../pages/verification/verification'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> PhoneService <span>}</span> from <span class="hljs-string">'../services/phone'</span>;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">    NewChatComponent,</pre><pre class="line-context">    MessagesOptionsComponent,</pre><pre class="line-context">    MessagesAttachmentsComponent,</pre><pre class="line-added">    NewLocationMessageComponent,</pre><pre class="line-added">    ShowPictureComponent</pre><pre class="line-context">  ],</pre><pre class="line-context">  imports: [</pre><pre class="line-context">    IonicModule.forRoot(MyApp),</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">    NewChatComponent,</pre><pre class="line-context">    MessagesOptionsComponent,</pre><pre class="line-context">    MessagesAttachmentsComponent,</pre><pre class="line-added">    NewLocationMessageComponent,</pre><pre class="line-added">    ShowPictureComponent</pre><pre class="line-context">  ],</pre><pre class="line-context">  providers: [</pre><pre class="line-context">    <span>{</span> provide: ErrorHandler, useClass: IonicErrorHandler <span>}</span>,</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L544">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>And now that we have that component ready, we will implement the <code>showPicture</code> method in the <code>MessagesPage</code> component, which will create a new instance of the <code>ShowPictureComponent</code>:</p>
<diffbox step="12.20" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.20</span> <span _ngcontent-35="" class="commit-summary">Implement showPicture method</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/244de7583d7d114c9b500668a531821361d113a4">client/imports/pages/messages/messages.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">268</pre><pre _ngcontent-35="" class="line-number">269</pre><pre _ngcontent-35="" class="line-number">270</pre><pre _ngcontent-35="" class="line-number">271</pre><pre _ngcontent-35="" class="line-number">272</pre><pre _ngcontent-35="" class="line-number">273</pre><pre _ngcontent-35="" class="line-number">274</pre><pre _ngcontent-35="" class="line-number">275</pre><pre _ngcontent-35="" class="line-number">276</pre><pre _ngcontent-35="" class="line-number">277</pre><pre _ngcontent-35="" class="line-number">278</pre><pre _ngcontent-35="" class="line-number">279</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Component, OnDestroy, OnInit, ElementRef <span>}</span> from <span class="hljs-string">'@angular/core'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> NavParams, PopoverController, ModalController <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MeteorObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> _ <span>}</span> from <span class="hljs-string">'meteor/underscore'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> * as Moment from <span class="hljs-string">'moment'</span>;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> PictureService <span>}</span> from <span class="hljs-string">'../../services/picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesAttachmentsComponent <span>}</span> from <span class="hljs-string">'./messages-attachments'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesOptionsComponent <span>}</span> from <span class="hljs-string">'./messages-options'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> ShowPictureComponent <span>}</span> from <span class="hljs-string">'./show-picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./messages.html'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">@Component(<span>{</span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">    navParams: NavParams,</pre><pre class="line-context">    <span class="hljs-keyword">private</span> el: ElementRef,</pre><pre class="line-context">    <span class="hljs-keyword">private</span> popoverCtrl: PopoverController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> pictureService: PictureService,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> modalCtrl: ModalController</pre><pre class="line-context">  ) <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">this</span>.selectedChat = &lt;Chat&gt;navParams.get(<span class="hljs-string">'chat'</span>);</pre><pre class="line-context">    <span class="hljs-keyword">this</span>.title = <span class="hljs-keyword">this</span>.selectedChat.title;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">      zoom: <span class="hljs-built_in">Math</span>.min(splitted[<span class="hljs-number">2</span>] || <span class="hljs-number">0</span>, <span class="hljs-number">19</span>)</pre><pre class="line-context">    <span>}</span>;</pre><pre class="line-context">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  showPicture(<span>{</span> target <span>}</span>: Event) <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">const</span> modal = <span class="hljs-keyword">this</span>.modalCtrl.create(ShowPictureComponent, <span>{</span></pre><pre class="line-added">      pictureSrc: (&lt;HTMLImageElement&gt;target).src</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-added">    modal.present();</pre><pre class="line-added">  <span>}</span></pre><pre class="line-context"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L586">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<h2 id="profile-picture">Profile Picture</h2>
<p>We have the ability to send picture messages. Now we will add the ability to change the user's profile picture using the infrastructure we've just created. To begin with, we will define a new property to our <code>User</code> model called <code>pictureId</code>, which will be used to determine the belonging profile picture of the current user:</p>
<diffbox step="12.21" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.21</span> <span _ngcontent-35="" class="commit-summary">Add pictureId property to Profile</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/8ff92bf28d6f1237e57da96d414544110fba8844">imports/models.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Profile <span>{</span></pre><pre class="line-context">  name?: <span class="hljs-built_in">string</span>;</pre><pre class="line-context">  picture?: <span class="hljs-built_in">string</span>;</pre><pre class="line-added">  pictureId?: <span class="hljs-built_in">string</span>;</pre><pre class="line-context"><span>}</span></pre><pre class="line-context"> </pre><pre class="line-context"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> MessageType <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L642">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>We will bind the editing button in the profile selection page into an event handler:</p>
<diffbox step="12.22" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.22</span> <span _ngcontent-35="" class="commit-summary">Add event for changing profile picture</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/d13653f624de0dffbd73457f11b883bb0656ec8a">client/imports/pages/profile/profile.html</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-tag">&lt;<span class="hljs-name">ion-content</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"profile-page-content"</span>&gt;</span></pre><pre class="line-context">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"profile-picture"</span>&gt;</span></pre><pre class="line-context">    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"picture"</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">"picture"</span>&gt;</span></pre><pre class="line-added">    <span class="hljs-tag">&lt;<span class="hljs-name">ion-icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"create"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"selectProfilePicture()"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ion-icon</span>&gt;</span></pre><pre class="line-context">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></pre><pre class="line-context"> </pre><pre class="line-context">  <span class="hljs-tag">&lt;<span class="hljs-name">ion-item</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"profile-name"</span>&gt;</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L660">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>And we will add all the missing logic in the component, so the <code>pictureId</code> will be transformed into and actual reference, and so we can have the ability to select a picture from our gallery and upload it:</p>
<diffbox step="12.23" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.23</span> <span _ngcontent-35="" class="commit-summary">Implement pick, update and set of profile image</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/152d35858bbc30427dcb5c605aae6514714bdf78">client/imports/pages/profile/profile.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre><pre _ngcontent-35="" class="line-number">44</pre><pre _ngcontent-35="" class="line-number">45</pre><pre _ngcontent-35="" class="line-number">46</pre><pre _ngcontent-35="" class="line-number">47</pre><pre _ngcontent-35="" class="line-number">48</pre><pre _ngcontent-35="" class="line-number">49</pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Component, OnInit <span>}</span> from <span class="hljs-string">'@angular/core'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> AlertController, NavController <span>}</span> from <span class="hljs-string">'ionic-angular'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MeteorObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Pictures <span>}</span> from <span class="hljs-string">'../../../../imports/collections'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Profile <span>}</span> from <span class="hljs-string">'../../../../imports/models'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> PictureService <span>}</span> from <span class="hljs-string">'../../services/picture'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> ChatsPage <span>}</span> from <span class="hljs-string">'../chats/chats'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./profile.html'</span>;</pre><pre class="line-context"> </pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context"> </pre><pre class="line-context">  <span class="hljs-keyword">constructor</span>(</pre><pre class="line-context">    <span class="hljs-keyword">private</span> alertCtrl: AlertController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> navCtrl: NavController,</pre><pre class="line-added">    <span class="hljs-keyword">private</span> pictureService: PictureService</pre><pre class="line-context">  ) <span>{</span><span>}</span></pre><pre class="line-context"> </pre><pre class="line-context">  ngOnInit(): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-context">    <span class="hljs-keyword">this</span>.profile = Meteor.user().profile || <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">''</span></pre><pre class="line-context">    <span>}</span>;</pre><pre class="line-added"> </pre><pre class="line-added">    MeteorObservable.subscribe(<span class="hljs-string">'user'</span>).subscribe(() =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">this</span>.picture = Pictures.getPictureUrl(<span class="hljs-keyword">this</span>.profile.pictureId);</pre><pre class="line-added">    <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  selectProfilePicture(): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">this</span>.pictureService.select().then((blob) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">this</span>.uploadProfilePicture(blob);</pre><pre class="line-added">    <span>}</span>)</pre><pre class="line-added">      .catch((e) =&gt; <span>{</span></pre><pre class="line-added">        <span class="hljs-keyword">this</span>.handleError(e);</pre><pre class="line-added">      <span>}</span>);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  uploadProfilePicture(blob: Blob): <span class="hljs-built_in">void</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">this</span>.pictureService.upload(blob).then((picture) =&gt; <span>{</span></pre><pre class="line-added">      <span class="hljs-keyword">this</span>.profile.pictureId = picture._id;</pre><pre class="line-added">      <span class="hljs-keyword">this</span>.picture = picture.url;</pre><pre class="line-added">    <span>}</span>)</pre><pre class="line-added">      .catch((e) =&gt; <span>{</span></pre><pre class="line-added">        <span class="hljs-keyword">this</span>.handleError(e);</pre><pre class="line-added">      <span>}</span>);</pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-context">  updateProfile(): <span class="hljs-built_in">void</span> <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L678">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>We will also define a new hook in the <code>Meteor.users</code> collection so whenever we update the profile picture, the previous one will be removed from the data-base. This way we won't have some unnecessary data in our data-base, which will save us some precious storage:</p>
<diffbox step="12.24" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.24</span> <span _ngcontent-35="" class="commit-summary">Add after hook for user modification</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/ce384ea25ded16b22e2c94dd039d671dfd11cebe">imports/collections/users.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number">11</pre><pre _ngcontent-35="" class="line-number">12</pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MongoObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Meteor <span>}</span> from <span class="hljs-string">'meteor/meteor'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> User <span>}</span> from <span class="hljs-string">'../models'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Pictures <span>}</span> from <span class="hljs-string">'./pictures'</span>;</pre><pre class="line-context"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Users = MongoObservable.fromExisting&lt;User&gt;(Meteor.users);</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-comment">// Dispose unused profile pictures</span></pre><pre class="line-added">Meteor.users.after.update(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">userId, doc, fieldNames, modifier, options</span>) </span><span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">if</span> (!doc.profile) <span class="hljs-keyword">return</span>;</pre><pre class="line-added">  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.previous.profile) <span class="hljs-keyword">return</span>;</pre><pre class="line-added">  <span class="hljs-keyword">if</span> (doc.profile.pictureId == <span class="hljs-keyword">this</span>.previous.profile.pictureId) <span class="hljs-keyword">return</span>;</pre><pre class="line-added"> </pre><pre class="line-added">  Pictures.collection.remove(<span>{</span> _id: doc.profile.pictureId <span>}</span>);</pre><pre class="line-added"><span>}</span>, <span>{</span> fetchPrevious: <span class="hljs-literal">true</span> <span>}</span>);</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L739">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Collection hooks are not part of <code>Meteor</code>'s official API and are added through a third-party package called <code>matb33:collection-hooks</code>. This requires us to install the necessary type definition:</p>
<pre><code>$ npm install --save-dev @types/meteor-collection-hooks
</code></pre><p>Now we need to import the type definition we've just installed in the <code>tsconfig.json</code> file:</p>
<diffbox step="12.26" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.26</span> <span _ngcontent-35="" class="commit-summary">Import @types/meteor-collection-hooks</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/c597b74fc1b9abf5e623521cc85ecccc3235cbf5">tsconfig.json</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">      <span class="hljs-string">"meteor-typings"</span>,</pre><pre class="line-context">      <span class="hljs-string">"@types/underscore"</span>,</pre><pre class="line-context">      <span class="hljs-string">"@types/meteor-accounts-phone"</span>,</pre><pre class="line-added">      <span class="hljs-string">"@types/meteor-publish-composite"</span>,</pre><pre class="line-added">      <span class="hljs-string">"@types/meteor-collection-hooks"</span></pre><pre class="line-context">    ]</pre><pre class="line-context">  <span>}</span>,</pre><pre class="line-context">  <span class="hljs-string">"include"</span>: [</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L770">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>We now add a <code>user</code> publication which should be subscribed whenever we initialize the <code>ProfilePage</code>. This subscription should fetch some data from other collections which is related to the user which is currently logged in; And to be more specific, the document associated with the <code>profileId</code> defined in the <code>User</code> model:</p>
<diffbox step="12.27" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.27</span> <span _ngcontent-35="" class="commit-summary">Add user publication</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/49af3004495a5f5bd2c33597efe9b4bd1b3a35cc">server/publications.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">73</pre><pre _ngcontent-35="" class="line-number">74</pre><pre _ngcontent-35="" class="line-number">75</pre><pre _ngcontent-35="" class="line-number">76</pre><pre _ngcontent-35="" class="line-number">77</pre><pre _ngcontent-35="" class="line-number">78</pre><pre _ngcontent-35="" class="line-number">79</pre><pre _ngcontent-35="" class="line-number">80</pre><pre _ngcontent-35="" class="line-number">81</pre><pre _ngcontent-35="" class="line-number">82</pre><pre _ngcontent-35="" class="line-number">83</pre><pre _ngcontent-35="" class="line-number">84</pre><pre _ngcontent-35="" class="line-number">85</pre><pre _ngcontent-35="" class="line-number">86</pre><pre _ngcontent-35="" class="line-number">87</pre><pre _ngcontent-35="" class="line-number">88</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Meteor <span>}</span> from <span class="hljs-string">'meteor/meteor'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Mongo <span>}</span> from <span class="hljs-string">'meteor/mongo'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Chats, Messages, Pictures, Users <span>}</span> from <span class="hljs-string">'../imports/collections'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Chat, Message, User <span>}</span> from <span class="hljs-string">'../imports/models'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">Meteor.publishComposite(<span class="hljs-string">'users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span></span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">      <span>}</span></pre><pre class="line-context">    ]</pre><pre class="line-context">  <span>}</span>;</pre><pre class="line-added"><span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-added">Meteor.publish(<span class="hljs-string">'user'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span><span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.userId) <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span>;</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  <span class="hljs-keyword">const</span> profile = Users.findOne(<span class="hljs-keyword">this</span>.userId).profile || <span>{</span><span>}</span>;</pre><pre class="line-added"> </pre><pre class="line-added">  <span class="hljs-keyword">return</span> Pictures.collection.find(<span>{</span></pre><pre class="line-added">    _id: profile.pictureId</pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"><span>}</span>);</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L790">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>We will also modify the <code>users</code> and <code>chats</code> publication, so each user will contain its corresponding picture document as well:</p>
<diffbox step="12.28" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.28</span> <span _ngcontent-35="" class="commit-summary">Added images to users publication</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/ac1a7d869ed136a4817649cdaf7d30a29ec66533">server/publications.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Meteor <span>}</span> from <span class="hljs-string">'meteor/meteor'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Mongo <span>}</span> from <span class="hljs-string">'meteor/mongo'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Chats, Messages, Pictures, Users <span>}</span> from <span class="hljs-string">'../imports/collections'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Chat, Message, Picture, User <span>}</span> from <span class="hljs-string">'../imports/models'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">Meteor.publishComposite(<span class="hljs-string">'users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span></span></pre><pre class="line-context">  pattern: <span class="hljs-built_in">string</span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">        fields: <span>{</span> profile: <span class="hljs-number">1</span> <span>}</span>,</pre><pre class="line-context">        limit: <span class="hljs-number">15</span></pre><pre class="line-context">      <span>}</span>);</pre><pre class="line-added">    <span>}</span>,</pre><pre class="line-added"> </pre><pre class="line-added">    children: [</pre><pre class="line-added">      &lt;PublishCompositeConfig1&lt;User, Picture&gt;&gt; <span>{</span></pre><pre class="line-added">        find: (user) =&gt; <span>{</span></pre><pre class="line-added">          <span class="hljs-keyword">return</span> Pictures.collection.find(user.profile.pictureId, <span>{</span></pre><pre class="line-added">            fields: <span>{</span> url: <span class="hljs-number">1</span> <span>}</span></pre><pre class="line-added">          <span>}</span>);</pre><pre class="line-added">        <span>}</span></pre><pre class="line-added">      <span>}</span></pre><pre class="line-added">    ]</pre><pre class="line-context">  <span>}</span>;</pre><pre class="line-context"><span>}</span>);</pre><pre class="line-context"> </pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L828">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<diffbox step="12.29" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.29</span> <span _ngcontent-35="" class="commit-summary">Add images to chats publication</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/74bcd4265c966ca46f32be9301ee428ab47c12a0">server/publications.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">79</pre><pre _ngcontent-35="" class="line-number">80</pre><pre _ngcontent-35="" class="line-number">81</pre><pre _ngcontent-35="" class="line-number">82</pre><pre _ngcontent-35="" class="line-number">83</pre><pre _ngcontent-35="" class="line-number">84</pre><pre _ngcontent-35="" class="line-number">85</pre><pre _ngcontent-35="" class="line-number">86</pre><pre _ngcontent-35="" class="line-number">87</pre><pre _ngcontent-35="" class="line-number">88</pre><pre _ngcontent-35="" class="line-number">89</pre><pre _ngcontent-35="" class="line-number">90</pre><pre _ngcontent-35="" class="line-number">91</pre><pre _ngcontent-35="" class="line-number">92</pre><pre _ngcontent-35="" class="line-number">93</pre><pre _ngcontent-35="" class="line-number">94</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">          <span>}</span>, <span>{</span></pre><pre class="line-context">            fields: <span>{</span> profile: <span class="hljs-number">1</span> <span>}</span></pre><pre class="line-context">          <span>}</span>);</pre><pre class="line-added">        <span>}</span>,</pre><pre class="line-added">        children: [</pre><pre class="line-added">          &lt;PublishCompositeConfig2&lt;Chat, User, Picture&gt;&gt; <span>{</span></pre><pre class="line-added">            find: (user, chat) =&gt; <span>{</span></pre><pre class="line-added">              <span class="hljs-keyword">return</span> Pictures.collection.find(user.profile.pictureId, <span>{</span></pre><pre class="line-added">                fields: <span>{</span> url: <span class="hljs-number">1</span> <span>}</span></pre><pre class="line-added">              <span>}</span>);</pre><pre class="line-added">            <span>}</span></pre><pre class="line-added">          <span>}</span></pre><pre class="line-added">        ]</pre><pre class="line-context">      <span>}</span></pre><pre class="line-context">    ]</pre><pre class="line-context">  <span>}</span>;</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L865">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Since we already set up some collection hooks on the users collection, we can take it a step further by defining collection hooks on the chat collection, so whenever a chat is being removed, all its corresponding messages will be removed as well:</p>
<diffbox step="12.30" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.30</span> <span _ngcontent-35="" class="commit-summary">Add hook for removing unused messages</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/8cd2d26edec98d557a792bb6e1b3a2169cc096e6">imports/collections/chats.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MongoObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Chat <span>}</span> from <span class="hljs-string">'../models'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Messages <span>}</span> from <span class="hljs-string">'./messages'</span>;</pre><pre class="line-context"> </pre><pre class="line-added"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Chats = <span class="hljs-keyword">new</span> MongoObservable.Collection&lt;Chat&gt;(<span class="hljs-string">'chats'</span>);</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-comment">// Dispose unused messages</span></pre><pre class="line-added">Chats.collection.after.remove(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">userId, doc</span>) </span><span>{</span></pre><pre class="line-added">  Messages.collection.remove(<span>{</span> chatId: doc._id <span>}</span>);</pre><pre class="line-added"><span>}</span>);</pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L893">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>We will now update the <code>updateProfile</code> method in the server to accept <code>pictureId</code>, so whenever we pick up a new profile picture the server won't reject it:</p>
<diffbox step="12.31" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.31</span> <span _ngcontent-35="" class="commit-summary">Allow updating pictureId</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/bc95e29d7304c31cc0e6107e7359c13f7a3a3793">server/methods.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">61</pre><pre _ngcontent-35="" class="line-number">62</pre><pre _ngcontent-35="" class="line-number">63</pre><pre _ngcontent-35="" class="line-number">64</pre><pre _ngcontent-35="" class="line-number">65</pre><pre _ngcontent-35="" class="line-number">66</pre><pre _ngcontent-35="" class="line-number">67</pre><pre _ngcontent-35="" class="line-number">68</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context">      <span class="hljs-string">'User must be logged-in to create a new chat'</span>);</pre><pre class="line-context"> </pre><pre class="line-context">    check(profile, <span>{</span></pre><pre class="line-added">      name: nonEmptyString,</pre><pre class="line-added">      pictureId: Match.Maybe(nonEmptyString)</pre><pre class="line-context">    <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-context">    Meteor.users.update(<span class="hljs-keyword">this</span>.userId, <span>{</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L915">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>Now we will update the users fabrication in our server's initialization, so instead of using hard-coded URLs, we will insert them as new documents to the <code>PicturesCollection</code>:</p>
<diffbox step="12.32" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.32</span> <span _ngcontent-35="" class="commit-summary">Update creation of users stubs</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/20b368d9d76a3c3e72ac4980654507e49ecbf835">server/main.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">1</pre><pre _ngcontent-35="" class="line-number">2</pre><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">13</pre><pre _ngcontent-35="" class="line-number">14</pre><pre _ngcontent-35="" class="line-number">15</pre><pre _ngcontent-35="" class="line-number">16</pre><pre _ngcontent-35="" class="line-number">17</pre><pre _ngcontent-35="" class="line-number">18</pre><pre _ngcontent-35="" class="line-number">19</pre><pre _ngcontent-35="" class="line-number">20</pre><pre _ngcontent-35="" class="line-number">21</pre><pre _ngcontent-35="" class="line-number">22</pre><pre _ngcontent-35="" class="line-number">23</pre><pre _ngcontent-35="" class="line-number">24</pre><pre _ngcontent-35="" class="line-number">25</pre><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre><pre _ngcontent-35="" class="line-number">33</pre><pre _ngcontent-35="" class="line-number">34</pre><pre _ngcontent-35="" class="line-number">35</pre><pre _ngcontent-35="" class="line-number">36</pre><pre _ngcontent-35="" class="line-number">37</pre><pre _ngcontent-35="" class="line-number">38</pre><pre _ngcontent-35="" class="line-number">39</pre><pre _ngcontent-35="" class="line-number">40</pre><pre _ngcontent-35="" class="line-number">41</pre><pre _ngcontent-35="" class="line-number">42</pre><pre _ngcontent-35="" class="line-number">43</pre><pre _ngcontent-35="" class="line-number">44</pre><pre _ngcontent-35="" class="line-number">45</pre><pre _ngcontent-35="" class="line-number">46</pre><pre _ngcontent-35="" class="line-number">47</pre><pre _ngcontent-35="" class="line-number">48</pre><pre _ngcontent-35="" class="line-number">49</pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre><pre _ngcontent-35="" class="line-number">57</pre><pre _ngcontent-35="" class="line-number">58</pre><pre _ngcontent-35="" class="line-number">59</pre><pre _ngcontent-35="" class="line-number">60</pre><pre _ngcontent-35="" class="line-number">61</pre><pre _ngcontent-35="" class="line-number">62</pre><pre _ngcontent-35="" class="line-number">63</pre><pre _ngcontent-35="" class="line-number">64</pre><pre _ngcontent-35="" class="line-number">65</pre><pre _ngcontent-35="" class="line-number">66</pre><pre _ngcontent-35="" class="line-number">67</pre><pre _ngcontent-35="" class="line-number">68</pre><pre _ngcontent-35="" class="line-number">69</pre><pre _ngcontent-35="" class="line-number">70</pre><pre _ngcontent-35="" class="line-number">71</pre><pre _ngcontent-35="" class="line-number">72</pre><pre _ngcontent-35="" class="line-number">73</pre><pre _ngcontent-35="" class="line-number">74</pre><pre _ngcontent-35="" class="line-number">75</pre><pre _ngcontent-35="" class="line-number">76</pre><pre _ngcontent-35="" class="line-number">77</pre><pre _ngcontent-35="" class="line-number">78</pre><pre _ngcontent-35="" class="line-number">79</pre><pre _ngcontent-35="" class="line-number">80</pre><pre _ngcontent-35="" class="line-number">81</pre><pre _ngcontent-35="" class="line-number">82</pre><pre _ngcontent-35="" class="line-number">83</pre><pre _ngcontent-35="" class="line-number">84</pre><pre _ngcontent-35="" class="line-number">85</pre><pre _ngcontent-35="" class="line-number">86</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Accounts <span>}</span> from <span class="hljs-string">'meteor/accounts-base'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Meteor <span>}</span> from <span class="hljs-string">'meteor/meteor'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Chats, Messages, Users <span>}</span> from <span class="hljs-string">'../imports/collections'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> MessageType, Picture <span>}</span> from <span class="hljs-string">'../imports/models'</span>;</pre><pre class="line-context"> </pre><pre class="line-context">Meteor.startup(() =&gt; <span>{</span></pre><pre class="line-context">  <span class="hljs-keyword">if</span> (Meteor.settings) <span>{</span></pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context">    <span class="hljs-keyword">return</span>;</pre><pre class="line-context">  <span>}</span></pre><pre class="line-context"> </pre><pre class="line-added">  <span class="hljs-keyword">let</span> picture = importPictureFromUrl(<span>{</span></pre><pre class="line-added">    name: <span class="hljs-string">'man1.jpg'</span>,</pre><pre class="line-added">    url: <span class="hljs-string">'https://randomuser.me/api/portraits/men/1.jpg'</span></pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-context">  Accounts.createUserWithPhone(<span>{</span></pre><pre class="line-context">    phone: <span class="hljs-string">'+972540000001'</span>,</pre><pre class="line-context">    profile: <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">'Ethan Gonzalez'</span>,</pre><pre class="line-added">      pictureId: picture._id</pre><pre class="line-context">    <span>}</span></pre><pre class="line-context">  <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-added">  picture = importPictureFromUrl(<span>{</span></pre><pre class="line-added">    name: <span class="hljs-string">'lego1.jpg'</span>,</pre><pre class="line-added">    url: <span class="hljs-string">'https://randomuser.me/api/portraits/lego/1.jpg'</span></pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-context">  Accounts.createUserWithPhone(<span>{</span></pre><pre class="line-context">    phone: <span class="hljs-string">'+972540000002'</span>,</pre><pre class="line-context">    profile: <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">'Bryan Wallace'</span>,</pre><pre class="line-added">      pictureId: picture._id</pre><pre class="line-context">    <span>}</span></pre><pre class="line-context">  <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-added">  picture = importPictureFromUrl(<span>{</span></pre><pre class="line-added">    name: <span class="hljs-string">'woman1.jpg'</span>,</pre><pre class="line-added">    url: <span class="hljs-string">'https://randomuser.me/api/portraits/women/1.jpg'</span></pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-context">  Accounts.createUserWithPhone(<span>{</span></pre><pre class="line-context">    phone: <span class="hljs-string">'+972540000003'</span>,</pre><pre class="line-context">    profile: <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">'Avery Stewart'</span>,</pre><pre class="line-added">      pictureId: picture._id</pre><pre class="line-context">    <span>}</span></pre><pre class="line-context">  <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-added">  picture = importPictureFromUrl(<span>{</span></pre><pre class="line-added">    name: <span class="hljs-string">'woman2.jpg'</span>,</pre><pre class="line-added">    url: <span class="hljs-string">'https://randomuser.me/api/portraits/women/2.jpg'</span></pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-context">  Accounts.createUserWithPhone(<span>{</span></pre><pre class="line-context">    phone: <span class="hljs-string">'+972540000004'</span>,</pre><pre class="line-context">    profile: <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">'Katie Peterson'</span>,</pre><pre class="line-added">      pictureId: picture._id</pre><pre class="line-context">    <span>}</span></pre><pre class="line-context">  <span>}</span>);</pre><pre class="line-context"> </pre><pre class="line-added">  picture = importPictureFromUrl(<span>{</span></pre><pre class="line-added">    name: <span class="hljs-string">'man2.jpg'</span>,</pre><pre class="line-added">    url: <span class="hljs-string">'https://randomuser.me/api/portraits/men/2.jpg'</span></pre><pre class="line-added">  <span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-context">  Accounts.createUserWithPhone(<span>{</span></pre><pre class="line-context">    phone: <span class="hljs-string">'+972540000005'</span>,</pre><pre class="line-context">    profile: <span>{</span></pre><pre class="line-context">      name: <span class="hljs-string">'Ray Edwards'</span>,</pre><pre class="line-added">      pictureId: picture._id</pre><pre class="line-context">    <span>}</span></pre><pre class="line-context">  <span>}</span>);</pre><pre class="line-added"><span>}</span>);</pre><pre class="line-added"> </pre><pre class="line-added"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">importPictureFromUrl</span>(<span class="hljs-params">options: <span>{</span> name: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span> <span>}</span></span>): <span class="hljs-title">Picture</span> </span><span>{</span></pre><pre class="line-added">  <span class="hljs-keyword">const</span> description = <span>{</span> name: options.name <span>}</span>;</pre><pre class="line-added"> </pre><pre class="line-added">  <span class="hljs-keyword">return</span> Meteor.call(<span class="hljs-string">'ufsImportURL'</span>, options.url, description, <span class="hljs-string">'pictures'</span>);</pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L935">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>To avoid some unexpected behaviors, we will reset our data-base so our server can re-fabricate the data:</p>
<pre><code>$ meteor reset
</code></pre><p>We will now update the <code>ChatsPage</code> to add the belonging picture for each chat during transformation:</p>
<diffbox step="12.33" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.33</span> <span _ngcontent-35="" class="commit-summary">Fetch user image from server</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/308a95045e1f2d0ae01c439b1e50b7df97066721">client/imports/pages/chats/chats.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number">10</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">50</pre><pre _ngcontent-35="" class="line-number">51</pre><pre _ngcontent-35="" class="line-number">52</pre><pre _ngcontent-35="" class="line-number">53</pre><pre _ngcontent-35="" class="line-number">54</pre><pre _ngcontent-35="" class="line-number">55</pre><pre _ngcontent-35="" class="line-number">56</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MeteorObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> * as Moment from <span class="hljs-string">'moment'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Observable, Subscriber <span>}</span> from <span class="hljs-string">'rxjs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Chats, Messages, Users, Pictures <span>}</span> from <span class="hljs-string">'../../../../imports/collections'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Chat, Message <span>}</span> from <span class="hljs-string">'../../../../imports/models'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> ChatsOptionsComponent <span>}</span> from <span class="hljs-string">'./chats-options'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MessagesPage <span>}</span> from <span class="hljs-string">'../messages/messages'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./chats.html'</span>;</pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context"> </pre><pre class="line-context">        <span class="hljs-keyword">if</span> (receiver) <span>{</span></pre><pre class="line-context">          chat.title = receiver.profile.name;</pre><pre class="line-added">          chat.picture = Pictures.getPictureUrl(receiver.profile.pictureId);</pre><pre class="line-context">        <span>}</span></pre><pre class="line-context"> </pre><pre class="line-context">        <span class="hljs-comment">// This will make the last message reactive</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L1042">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<p>And we will do the same in the <code>NewChatComponent</code>:</p>
<diffbox step="12.34" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.34</span> <span _ngcontent-35="" class="commit-summary">Use the new pictureId field for new chat modal</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/095179620776ebcecabfa1bfe99c82ab73133aea">client/imports/pages/chats/new-chat.html</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">26</pre><pre _ngcontent-35="" class="line-number">27</pre><pre _ngcontent-35="" class="line-number">28</pre><pre _ngcontent-35="" class="line-number">29</pre><pre _ngcontent-35="" class="line-number">30</pre><pre _ngcontent-35="" class="line-number">31</pre><pre _ngcontent-35="" class="line-number">32</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-tag">&lt;<span class="hljs-name">ion-content</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"new-chat"</span>&gt;</span></pre><pre class="line-context">  <span class="hljs-tag">&lt;<span class="hljs-name">ion-list</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"users"</span>&gt;</span></pre><pre class="line-context">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">ion-item</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let user of users | async"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"addChat(user)"</span>&gt;</span></pre><pre class="line-added">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-picture"</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">"getPic(user.profile.pictureId)"</span>&gt;</span></pre><pre class="line-context">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-name"</span>&gt;</span><span>{</span><span>{</span>user.profile.name<span>}</span><span>}</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></pre><pre class="line-context">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></pre><pre class="line-context">  <span class="hljs-tag">&lt;/<span class="hljs-name">ion-list</span>&gt;</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L1074">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox>

<diffbox step="12.35" tutorial="whatsapp2-meteor-tutorial" _nghost-35="">
<!--template bindings={}--><div _ngcontent-35="">
  <!--template bindings={}--><div _ngcontent-35="" class="diffbox">
    <div _ngcontent-35="" class="title-panel">
      <span _ngcontent-35="" class="step-number">12.35</span> <span _ngcontent-35="" class="commit-summary">Implement getPic</span>
      <a _ngcontent-35="" class="github-commit-link" target="_blank" href="http://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/commit/1b1c877f9e20c8bf6139db505613277a08b35936">client/imports/pages/chats/new-chat.ts</a>
    </div>
    <div _ngcontent-35="" class="code-container">
      <div _ngcontent-35="" class="scroll-container">
        <div _ngcontent-35="" class="line-numbers">
          <!--template bindings={}--><pre _ngcontent-35="" class="line-number">3</pre><pre _ngcontent-35="" class="line-number">4</pre><pre _ngcontent-35="" class="line-number">5</pre><pre _ngcontent-35="" class="line-number">6</pre><pre _ngcontent-35="" class="line-number">7</pre><pre _ngcontent-35="" class="line-number">8</pre><pre _ngcontent-35="" class="line-number">9</pre><pre _ngcontent-35="" class="line-number"> </pre><pre _ngcontent-35="" class="line-number">107</pre><pre _ngcontent-35="" class="line-number">108</pre><pre _ngcontent-35="" class="line-number">109</pre><pre _ngcontent-35="" class="line-number">110</pre><pre _ngcontent-35="" class="line-number">111</pre><pre _ngcontent-35="" class="line-number">112</pre><pre _ngcontent-35="" class="line-number">113</pre><pre _ngcontent-35="" class="line-number">114</pre>
        </div>
        <div _ngcontent-35="" class="line-content"></div><diffbox-container><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> MeteorObservable <span>}</span> from <span class="hljs-string">'meteor-rxjs'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> _ <span>}</span> from <span class="hljs-string">'meteor/underscore'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> Observable, Subscription, BehaviorSubject <span>}</span> from <span class="hljs-string">'rxjs'</span>;</pre><pre class="line-added"><span class="hljs-keyword">import</span> <span>{</span> Chats, Pictures, Users <span>}</span> from <span class="hljs-string">'../../../../imports/collections'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> <span>{</span> User <span>}</span> from <span class="hljs-string">'../../../../imports/models'</span>;</pre><pre class="line-context"><span class="hljs-keyword">import</span> template from <span class="hljs-string">'./new-chat.html'</span>;</pre><pre class="line-context"> </pre><pre class="undefined"><span class="hljs-comment">...some lines skipped...</span></pre><pre class="line-context"> </pre><pre class="line-context">    alert.present();</pre><pre class="line-context">  <span>}</span></pre><pre class="line-added"> </pre><pre class="line-added">  getPic(pictureId): <span class="hljs-built_in">string</span> <span>{</span></pre><pre class="line-added">    <span class="hljs-keyword">return</span> Pictures.getPictureUrl(pictureId);</pre><pre class="line-added">  <span>}</span></pre><pre class="line-added"><span>}</span></pre></diffbox-container>
      </div>
      <!--template bindings={}--><div _ngcontent-35="" class="improve-code">
        <a _ngcontent-35="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/views/step12.md#L1091">Improve this code</a>
      </div>
    </div>
  </div>
</div></diffbox></tutorial-container><!--template bindings={}-->
      <br><br>
      <div class="top-navigation">
        <div class="tutorial-nav">
          <a class="md-primary tutorial-button" md-raised-button="" tutorialNavigation="previous" aria-disabled="false" href="/tutorials/whatsapp2/meteor/google-maps"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">navigate_before</i>Previous</span>
          </span> </a>
          <a class="md-primary tutorial-button" codeDiffLink="" md-raised-button="" aria-disabled="false" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/compare/step11...step12"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">search</i>Code Diff</span>
          </span> </a>
          <a class="md-primary tutorial-button" md-raised-button="" tutorialNavigation="next" aria-disabled="false" href="/tutorials/whatsapp2/meteor/native-mobile"><span class="md-button-wrapper">
            <span class="button-wrapper right-icon">Next<i class="material-icons">navigate_next</i></span>
          </span> </a>
        </div>

        <div class="improve">
          <a class="md-primary improv-button tutorial-button" md-raised-button="" href="https://github.com/Urigo/Ionic2-MeteorCLI-WhatsApp/edit/master/manuals/templates/step12.md" aria-disabled="false"><span class="md-button-wrapper">
            <span class="button-wrapper"><i class="material-icons">mode_edit</i>Improve This Tutorial</span>
          </span> </a>
        </div>
      </div>
    </div>
  </div>
</div>
</tutorial>

</app>

  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PKC4D4"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PKC4D4');</script>
  <!-- End Google Tag Manager -->



<style type="text/css">@charset "UTF-8";.hljs{background:#f0f0f0}.hljs-doctag,.hljs-meta-keyword{font-weight:700}.hljs-deletion,.hljs-selector-class,.hljs-template-tag{color:#800}.hljs-selector-attr,.hljs-selector-pseudo{color:#bc6060}.hljs-addition,.hljs-code{color:#397300}.hljs-meta-string{color:#4d99bf}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag{color:#333;font-weight:700}.hljs-subst{color:#333}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@font-face{font-family:'FontAwesome';src:url(assets/fonts/fontawesome-webfont.eot?v=4.7.0);src:url(assets/fonts/fontawesome-webfont.eot?#iefix&v=4.7.0) format("embedded-opentype"),url(assets/fonts/fontawesome-webfont.woff2?v=4.7.0) format("woff2"),url(assets/fonts/fontawesome-webfont.woff?v=4.7.0) format("woff"),url(assets/fonts/fontawesome-webfont.ttf?v=4.7.0) format("truetype"),url(assets/fonts/fontawesome-webfont.svg?v=4.7.0#fontawesomeregular) format("svg");font-weight:400;font-style:normal}.fa{display:inline-block;font:14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14286em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14286em;width:2.14286em;top:.14286em;text-align:center}.fa-li.fa-lg{left:-1.85714em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.fa-pull-left{float:left}.fa-pull-right,.pull-right{float:right}.fa.fa-pull-left{margin-right:.3em}.fa.fa-pull-right{margin-left:.3em}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scale(-1,1);-ms-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(1,-1);-ms-transform:scale(1,-1);transform:scale(1,-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:""}.fa-music:before{content:""}.fa-search:before{content:""}.fa-envelope-o:before{content:""}.fa-heart:before{content:""}.fa-star:before{content:""}.fa-star-o:before{content:""}.fa-user:before{content:""}.fa-film:before{content:""}.fa-th-large:before{content:""}.fa-th:before{content:""}.fa-th-list:before{content:""}.fa-check:before{content:""}.fa-close:before,.fa-remove:before,.fa-times:before{content:""}.fa-search-plus:before{content:""}.fa-search-minus:before{content:""}.fa-power-off:before{content:""}.fa-signal:before{content:""}.fa-cog:before,.fa-gear:before{content:""}.fa-trash-o:before{content:""}.fa-home:before{content:""}.fa-file-o:before{content:""}.fa-clock-o:before{content:""}.fa-road:before{content:""}.fa-download:before{content:""}.fa-arrow-circle-o-down:before{content:""}.fa-arrow-circle-o-up:before{content:""}.fa-inbox:before{content:""}.fa-play-circle-o:before{content:""}.fa-repeat:before,.fa-rotate-right:before{content:""}.fa-refresh:before{content:""}.fa-list-alt:before{content:""}.fa-lock:before{content:""}.fa-flag:before{content:""}.fa-headphones:before{content:""}.fa-volume-off:before{content:""}.fa-volume-down:before{content:""}.fa-volume-up:before{content:""}.fa-qrcode:before{content:""}.fa-barcode:before{content:""}.fa-tag:before{content:""}.fa-tags:before{content:""}.fa-book:before{content:""}.fa-bookmark:before{content:""}.fa-print:before{content:""}.fa-camera:before{content:""}.fa-font:before{content:""}.fa-bold:before{content:""}.fa-italic:before{content:""}.fa-text-height:before{content:""}.fa-text-width:before{content:""}.fa-align-left:before{content:""}.fa-align-center:before{content:""}.fa-align-right:before{content:""}.fa-align-justify:before{content:""}.fa-list:before{content:""}.fa-dedent:before,.fa-outdent:before{content:""}.fa-indent:before{content:""}.fa-video-camera:before{content:""}.fa-image:before,.fa-photo:before,.fa-picture-o:before{content:""}.fa-pencil:before{content:""}.fa-map-marker:before{content:""}.fa-adjust:before{content:""}.fa-tint:before{content:""}.fa-edit:before,.fa-pencil-square-o:before{content:""}.fa-share-square-o:before{content:""}.fa-check-square-o:before{content:""}.fa-arrows:before{content:""}.fa-step-backward:before{content:""}.fa-fast-backward:before{content:""}.fa-backward:before{content:""}.fa-play:before{content:""}.fa-pause:before{content:""}.fa-stop:before{content:""}.fa-forward:before{content:""}.fa-fast-forward:before{content:""}.fa-step-forward:before{content:""}.fa-eject:before{content:""}.fa-chevron-left:before{content:""}.fa-chevron-right:before{content:""}.fa-plus-circle:before{content:""}.fa-minus-circle:before{content:""}.fa-times-circle:before{content:""}.fa-check-circle:before{content:""}.fa-question-circle:before{content:""}.fa-info-circle:before{content:""}.fa-crosshairs:before{content:""}.fa-times-circle-o:before{content:""}.fa-check-circle-o:before{content:""}.fa-ban:before{content:""}.fa-arrow-left:before{content:""}.fa-arrow-right:before{content:""}.fa-arrow-up:before{content:""}.fa-arrow-down:before{content:""}.fa-mail-forward:before,.fa-share:before{content:""}.fa-expand:before{content:""}.fa-compress:before{content:""}.fa-plus:before{content:""}.fa-minus:before{content:""}.fa-asterisk:before{content:""}.fa-exclamation-circle:before{content:""}.fa-gift:before{content:""}.fa-leaf:before{content:""}.fa-fire:before{content:""}.fa-eye:before{content:""}.fa-eye-slash:before{content:""}.fa-exclamation-triangle:before,.fa-warning:before{content:""}.fa-plane:before{content:""}.fa-calendar:before{content:""}.fa-random:before{content:""}.fa-comment:before{content:""}.fa-magnet:before{content:""}.fa-chevron-up:before{content:""}.fa-chevron-down:before{content:""}.fa-retweet:before{content:""}.fa-shopping-cart:before{content:""}.fa-folder:before{content:""}.fa-folder-open:before{content:""}.fa-arrows-v:before{content:""}.fa-arrows-h:before{content:""}.fa-bar-chart-o:before,.fa-bar-chart:before{content:""}.fa-twitter-square:before{content:""}.fa-facebook-square:before{content:""}.fa-camera-retro:before{content:""}.fa-key:before{content:""}.fa-cogs:before,.fa-gears:before{content:""}.fa-comments:before{content:""}.fa-thumbs-o-up:before{content:""}.fa-thumbs-o-down:before{content:""}.fa-star-half:before{content:""}.fa-heart-o:before{content:""}.fa-sign-out:before{content:""}.fa-linkedin-square:before{content:""}.fa-thumb-tack:before{content:""}.fa-external-link:before{content:""}.fa-sign-in:before{content:""}.fa-trophy:before{content:""}.fa-github-square:before{content:""}.fa-upload:before{content:""}.fa-lemon-o:before{content:""}.fa-phone:before{content:""}.fa-square-o:before{content:""}.fa-bookmark-o:before{content:""}.fa-phone-square:before{content:""}.fa-twitter:before{content:""}.fa-facebook-f:before,.fa-facebook:before{content:""}.fa-github:before{content:""}.fa-unlock:before{content:""}.fa-credit-card:before{content:""}.fa-feed:before,.fa-rss:before{content:""}.fa-hdd-o:before{content:""}.fa-bullhorn:before{content:""}.fa-bell:before{content:""}.fa-certificate:before{content:""}.fa-hand-o-right:before{content:""}.fa-hand-o-left:before{content:""}.fa-hand-o-up:before{content:""}.fa-hand-o-down:before{content:""}.fa-arrow-circle-left:before{content:""}.fa-arrow-circle-right:before{content:""}.fa-arrow-circle-up:before{content:""}.fa-arrow-circle-down:before{content:""}.fa-globe:before{content:""}.fa-wrench:before{content:""}.fa-tasks:before{content:""}.fa-filter:before{content:""}.fa-briefcase:before{content:""}.fa-arrows-alt:before{content:""}.fa-group:before,.fa-users:before{content:""}.fa-chain:before,.fa-link:before{content:""}.fa-cloud:before{content:""}.fa-flask:before{content:""}.fa-cut:before,.fa-scissors:before{content:""}.fa-copy:before,.fa-files-o:before{content:""}.fa-paperclip:before{content:""}.fa-floppy-o:before,.fa-save:before{content:""}.fa-square:before{content:""}.fa-bars:before,.fa-navicon:before,.fa-reorder:before{content:""}.fa-list-ul:before{content:""}.fa-list-ol:before{content:""}.fa-strikethrough:before{content:""}.fa-underline:before{content:""}.fa-table:before{content:""}.fa-magic:before{content:""}.fa-truck:before{content:""}.fa-pinterest:before{content:""}.fa-pinterest-square:before{content:""}.fa-google-plus-square:before{content:""}.fa-google-plus:before{content:""}.fa-money:before{content:""}.fa-caret-down:before{content:""}.fa-caret-up:before{content:""}.fa-caret-left:before{content:""}.fa-caret-right:before{content:""}.fa-columns:before{content:""}.fa-sort:before,.fa-unsorted:before{content:""}.fa-sort-desc:before,.fa-sort-down:before{content:""}.fa-sort-asc:before,.fa-sort-up:before{content:""}.fa-envelope:before{content:""}.fa-linkedin:before{content:""}.fa-rotate-left:before,.fa-undo:before{content:""}.fa-gavel:before,.fa-legal:before{content:""}.fa-dashboard:before,.fa-tachometer:before{content:""}.fa-comment-o:before{content:""}.fa-comments-o:before{content:""}.fa-bolt:before,.fa-flash:before{content:""}.fa-sitemap:before{content:""}.fa-umbrella:before{content:""}.fa-clipboard:before,.fa-paste:before{content:""}.fa-lightbulb-o:before{content:""}.fa-exchange:before{content:""}.fa-cloud-download:before{content:""}.fa-cloud-upload:before{content:""}.fa-user-md:before{content:""}.fa-stethoscope:before{content:""}.fa-suitcase:before{content:""}.fa-bell-o:before{content:""}.fa-coffee:before{content:""}.fa-cutlery:before{content:""}.fa-file-text-o:before{content:""}.fa-building-o:before{content:""}.fa-hospital-o:before{content:""}.fa-ambulance:before{content:""}.fa-medkit:before{content:""}.fa-fighter-jet:before{content:""}.fa-beer:before{content:""}.fa-h-square:before{content:""}.fa-plus-square:before{content:""}.fa-angle-double-left:before{content:""}.fa-angle-double-right:before{content:""}.fa-angle-double-up:before{content:""}.fa-angle-double-down:before{content:""}.fa-angle-left:before{content:""}.fa-angle-right:before{content:""}.fa-angle-up:before{content:""}.fa-angle-down:before{content:""}.fa-desktop:before{content:""}.fa-laptop:before{content:""}.fa-tablet:before{content:""}.fa-mobile-phone:before,.fa-mobile:before{content:""}.fa-circle-o:before{content:""}.fa-quote-left:before{content:""}.fa-quote-right:before{content:""}.fa-spinner:before{content:""}.fa-circle:before{content:""}.fa-mail-reply:before,.fa-reply:before{content:""}.fa-github-alt:before{content:""}.fa-folder-o:before{content:""}.fa-folder-open-o:before{content:""}.fa-smile-o:before{content:""}.fa-frown-o:before{content:""}.fa-meh-o:before{content:""}.fa-gamepad:before{content:""}.fa-keyboard-o:before{content:""}.fa-flag-o:before{content:""}.fa-flag-checkered:before{content:""}.fa-terminal:before{content:""}.fa-code:before{content:""}.fa-mail-reply-all:before,.fa-reply-all:before{content:""}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:""}.fa-location-arrow:before{content:""}.fa-crop:before{content:""}.fa-code-fork:before{content:""}.fa-chain-broken:before,.fa-unlink:before{content:""}.fa-question:before{content:""}.fa-info:before{content:""}.fa-exclamation:before{content:""}.fa-superscript:before{content:""}.fa-subscript:before{content:""}.fa-eraser:before{content:""}.fa-puzzle-piece:before{content:""}.fa-microphone:before{content:""}.fa-microphone-slash:before{content:""}.fa-shield:before{content:""}.fa-calendar-o:before{content:""}.fa-fire-extinguisher:before{content:""}.fa-rocket:before{content:""}.fa-maxcdn:before{content:""}.fa-chevron-circle-left:before{content:""}.fa-chevron-circle-right:before{content:""}.fa-chevron-circle-up:before{content:""}.fa-chevron-circle-down:before{content:""}.fa-html5:before{content:""}.fa-css3:before{content:""}.fa-anchor:before{content:""}.fa-unlock-alt:before{content:""}.fa-bullseye:before{content:""}.fa-ellipsis-h:before{content:""}.fa-ellipsis-v:before{content:""}.fa-rss-square:before{content:""}.fa-play-circle:before{content:""}.fa-ticket:before{content:""}.fa-minus-square:before{content:""}.fa-minus-square-o:before{content:""}.fa-level-up:before{content:""}.fa-level-down:before{content:""}.fa-check-square:before{content:""}.fa-pencil-square:before{content:""}.fa-external-link-square:before{content:""}.fa-share-square:before{content:""}.fa-compass:before{content:""}.fa-caret-square-o-down:before,.fa-toggle-down:before{content:""}.fa-caret-square-o-up:before,.fa-toggle-up:before{content:""}.fa-caret-square-o-right:before,.fa-toggle-right:before{content:""}.fa-eur:before,.fa-euro:before{content:""}.fa-gbp:before{content:""}.fa-dollar:before,.fa-usd:before{content:""}.fa-inr:before,.fa-rupee:before{content:""}.fa-cny:before,.fa-jpy:before,.fa-rmb:before,.fa-yen:before{content:""}.fa-rouble:before,.fa-rub:before,.fa-ruble:before{content:""}.fa-krw:before,.fa-won:before{content:""}.fa-bitcoin:before,.fa-btc:before{content:""}.fa-file:before{content:""}.fa-file-text:before{content:""}.fa-sort-alpha-asc:before{content:""}.fa-sort-alpha-desc:before{content:""}.fa-sort-amount-asc:before{content:""}.fa-sort-amount-desc:before{content:""}.fa-sort-numeric-asc:before{content:""}.fa-sort-numeric-desc:before{content:""}.fa-thumbs-up:before{content:""}.fa-thumbs-down:before{content:""}.fa-youtube-square:before{content:""}.fa-youtube:before{content:""}.fa-xing:before{content:""}.fa-xing-square:before{content:""}.fa-youtube-play:before{content:""}.fa-dropbox:before{content:""}.fa-stack-overflow:before{content:""}.fa-instagram:before{content:""}.fa-flickr:before{content:""}.fa-adn:before{content:""}.fa-bitbucket:before{content:""}.fa-bitbucket-square:before{content:""}.fa-tumblr:before{content:""}.fa-tumblr-square:before{content:""}.fa-long-arrow-down:before{content:""}.fa-long-arrow-up:before{content:""}.fa-long-arrow-left:before{content:""}.fa-long-arrow-right:before{content:""}.fa-apple:before{content:""}.fa-windows:before{content:""}.fa-android:before{content:""}.fa-linux:before{content:""}.fa-dribbble:before{content:""}.fa-skype:before{content:""}.fa-foursquare:before{content:""}.fa-trello:before{content:""}.fa-female:before{content:""}.fa-male:before{content:""}.fa-gittip:before,.fa-gratipay:before{content:""}.fa-sun-o:before{content:""}.fa-moon-o:before{content:""}.fa-archive:before{content:""}.fa-bug:before{content:""}.fa-vk:before{content:""}.fa-weibo:before{content:""}.fa-renren:before{content:""}.fa-pagelines:before{content:""}.fa-stack-exchange:before{content:""}.fa-arrow-circle-o-right:before{content:""}.fa-arrow-circle-o-left:before{content:""}.fa-caret-square-o-left:before,.fa-toggle-left:before{content:""}.fa-dot-circle-o:before{content:""}.fa-wheelchair:before{content:""}.fa-vimeo-square:before{content:""}.fa-try:before,.fa-turkish-lira:before{content:""}.fa-plus-square-o:before{content:""}.fa-space-shuttle:before{content:""}.fa-slack:before{content:""}.fa-envelope-square:before{content:""}.fa-wordpress:before{content:""}.fa-openid:before{content:""}.fa-bank:before,.fa-institution:before,.fa-university:before{content:""}.fa-graduation-cap:before,.fa-mortar-board:before{content:""}.fa-yahoo:before{content:""}.fa-google:before{content:""}.fa-reddit:before{content:""}.fa-reddit-square:before{content:""}.fa-stumbleupon-circle:before{content:""}.fa-stumbleupon:before{content:""}.fa-delicious:before{content:""}.fa-digg:before{content:""}.fa-pied-piper-pp:before{content:""}.fa-pied-piper-alt:before{content:""}.fa-drupal:before{content:""}.fa-joomla:before{content:""}.fa-language:before{content:""}.fa-fax:before{content:""}.fa-building:before{content:""}.fa-child:before{content:""}.fa-paw:before{content:""}.fa-spoon:before{content:""}.fa-cube:before{content:""}.fa-cubes:before{content:""}.fa-behance:before{content:""}.fa-behance-square:before{content:""}.fa-steam:before{content:""}.fa-steam-square:before{content:""}.fa-recycle:before{content:""}.fa-automobile:before,.fa-car:before{content:""}.fa-cab:before,.fa-taxi:before{content:""}.fa-tree:before{content:""}.fa-spotify:before{content:""}.fa-deviantart:before{content:""}.fa-soundcloud:before{content:""}.fa-database:before{content:""}.fa-file-pdf-o:before{content:""}.fa-file-word-o:before{content:""}.fa-file-excel-o:before{content:""}.fa-file-powerpoint-o:before{content:""}.fa-file-image-o:before,.fa-file-photo-o:before,.fa-file-picture-o:before{content:""}.fa-file-archive-o:before,.fa-file-zip-o:before{content:""}.fa-file-audio-o:before,.fa-file-sound-o:before{content:""}.fa-file-movie-o:before,.fa-file-video-o:before{content:""}.fa-file-code-o:before{content:""}.fa-vine:before{content:""}.fa-codepen:before{content:""}.fa-jsfiddle:before{content:""}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-ring:before,.fa-life-saver:before,.fa-support:before{content:""}.fa-circle-o-notch:before{content:""}.fa-ra:before,.fa-rebel:before,.fa-resistance:before{content:""}.fa-empire:before,.fa-ge:before{content:""}.fa-git-square:before{content:""}.fa-git:before{content:""}.fa-hacker-news:before,.fa-y-combinator-square:before,.fa-yc-square:before{content:""}.fa-tencent-weibo:before{content:""}.fa-qq:before{content:""}.fa-wechat:before,.fa-weixin:before{content:""}.fa-paper-plane:before,.fa-send:before{content:""}.fa-paper-plane-o:before,.fa-send-o:before{content:""}.fa-history:before{content:""}.fa-circle-thin:before{content:""}.fa-header:before{content:""}.fa-paragraph:before{content:""}.fa-sliders:before{content:""}.fa-share-alt:before{content:""}.fa-share-alt-square:before{content:""}.fa-bomb:before{content:""}.fa-futbol-o:before,.fa-soccer-ball-o:before{content:""}.fa-tty:before{content:""}.fa-binoculars:before{content:""}.fa-plug:before{content:""}.fa-slideshare:before{content:""}.fa-twitch:before{content:""}.fa-yelp:before{content:""}.fa-newspaper-o:before{content:""}.fa-wifi:before{content:""}.fa-calculator:before{content:""}.fa-paypal:before{content:""}.fa-google-wallet:before{content:""}.fa-cc-visa:before{content:""}.fa-cc-mastercard:before{content:""}.fa-cc-discover:before{content:""}.fa-cc-amex:before{content:""}.fa-cc-paypal:before{content:""}.fa-cc-stripe:before{content:""}.fa-bell-slash:before{content:""}.fa-bell-slash-o:before{content:""}.fa-trash:before{content:""}.fa-copyright:before{content:""}.fa-at:before{content:""}.fa-eyedropper:before{content:""}.fa-paint-brush:before{content:""}.fa-birthday-cake:before{content:""}.fa-area-chart:before{content:""}.fa-pie-chart:before{content:""}.fa-line-chart:before{content:""}.fa-lastfm:before{content:""}.fa-lastfm-square:before{content:""}.fa-toggle-off:before{content:""}.fa-toggle-on:before{content:""}.fa-bicycle:before{content:""}.fa-bus:before{content:""}.fa-ioxhost:before{content:""}.fa-angellist:before{content:""}.fa-cc:before{content:""}.fa-ils:before,.fa-shekel:before,.fa-sheqel:before{content:""}.fa-meanpath:before{content:""}.fa-buysellads:before{content:""}.fa-connectdevelop:before{content:""}.fa-dashcube:before{content:""}.fa-forumbee:before{content:""}.fa-leanpub:before{content:""}.fa-sellsy:before{content:""}.fa-shirtsinbulk:before{content:""}.fa-simplybuilt:before{content:""}.fa-skyatlas:before{content:""}.fa-cart-plus:before{content:""}.fa-cart-arrow-down:before{content:""}.fa-diamond:before{content:""}.fa-ship:before{content:""}.fa-user-secret:before{content:""}.fa-motorcycle:before{content:""}.fa-street-view:before{content:""}.fa-heartbeat:before{content:""}.fa-venus:before{content:""}.fa-mars:before{content:""}.fa-mercury:before{content:""}.fa-intersex:before,.fa-transgender:before{content:""}.fa-transgender-alt:before{content:""}.fa-venus-double:before{content:""}.fa-mars-double:before{content:""}.fa-venus-mars:before{content:""}.fa-mars-stroke:before{content:""}.fa-mars-stroke-v:before{content:""}.fa-mars-stroke-h:before{content:""}.fa-neuter:before{content:""}.fa-genderless:before{content:""}.fa-facebook-official:before{content:""}.fa-pinterest-p:before{content:""}.fa-whatsapp:before{content:""}.fa-server:before{content:""}.fa-user-plus:before{content:""}.fa-user-times:before{content:""}.fa-bed:before,.fa-hotel:before{content:""}.fa-viacoin:before{content:""}.fa-train:before{content:""}.fa-subway:before{content:""}.fa-medium:before{content:""}.fa-y-combinator:before,.fa-yc:before{content:""}.fa-optin-monster:before{content:""}.fa-opencart:before{content:""}.fa-expeditedssl:before{content:""}.fa-battery-4:before,.fa-battery-full:before,.fa-battery:before{content:""}.fa-battery-3:before,.fa-battery-three-quarters:before{content:""}.fa-battery-2:before,.fa-battery-half:before{content:""}.fa-battery-1:before,.fa-battery-quarter:before{content:""}.fa-battery-0:before,.fa-battery-empty:before{content:""}.fa-mouse-pointer:before{content:""}.fa-i-cursor:before{content:""}.fa-object-group:before{content:""}.fa-object-ungroup:before{content:""}.fa-sticky-note:before{content:""}.fa-sticky-note-o:before{content:""}.fa-cc-jcb:before{content:""}.fa-cc-diners-club:before{content:""}.fa-clone:before{content:""}.fa-balance-scale:before{content:""}.fa-hourglass-o:before{content:""}.fa-hourglass-1:before,.fa-hourglass-start:before{content:""}.fa-hourglass-2:before,.fa-hourglass-half:before{content:""}.fa-hourglass-3:before,.fa-hourglass-end:before{content:""}.fa-hourglass:before{content:""}.fa-hand-grab-o:before,.fa-hand-rock-o:before{content:""}.fa-hand-paper-o:before,.fa-hand-stop-o:before{content:""}.fa-hand-scissors-o:before{content:""}.fa-hand-lizard-o:before{content:""}.fa-hand-spock-o:before{content:""}.fa-hand-pointer-o:before{content:""}.fa-hand-peace-o:before{content:""}.fa-trademark:before{content:""}.fa-registered:before{content:""}.fa-creative-commons:before{content:""}.fa-gg:before{content:""}.fa-gg-circle:before{content:""}.fa-tripadvisor:before{content:""}.fa-odnoklassniki:before{content:""}.fa-odnoklassniki-square:before{content:""}.fa-get-pocket:before{content:""}.fa-wikipedia-w:before{content:""}.fa-safari:before{content:""}.fa-chrome:before{content:""}.fa-firefox:before{content:""}.fa-opera:before{content:""}.fa-internet-explorer:before{content:""}.fa-television:before,.fa-tv:before{content:""}.fa-contao:before{content:""}.fa-500px:before{content:""}.fa-amazon:before{content:""}.fa-calendar-plus-o:before{content:""}.fa-calendar-minus-o:before{content:""}.fa-calendar-times-o:before{content:""}.fa-calendar-check-o:before{content:""}.fa-industry:before{content:""}.fa-map-pin:before{content:""}.fa-map-signs:before{content:""}.fa-map-o:before{content:""}.fa-map:before{content:""}.fa-commenting:before{content:""}.fa-commenting-o:before{content:""}.fa-houzz:before{content:""}.fa-vimeo:before{content:""}.fa-black-tie:before{content:""}.fa-fonticons:before{content:""}.fa-reddit-alien:before{content:""}.fa-edge:before{content:""}.fa-credit-card-alt:before{content:""}.fa-codiepie:before{content:""}.fa-modx:before{content:""}.fa-fort-awesome:before{content:""}.fa-usb:before{content:""}.fa-product-hunt:before{content:""}.fa-mixcloud:before{content:""}.fa-scribd:before{content:""}.fa-pause-circle:before{content:""}.fa-pause-circle-o:before{content:""}.fa-stop-circle:before{content:""}.fa-stop-circle-o:before{content:""}.fa-shopping-bag:before{content:""}.fa-shopping-basket:before{content:""}.fa-hashtag:before{content:""}.fa-bluetooth:before{content:""}.fa-bluetooth-b:before{content:""}.fa-percent:before{content:""}.fa-gitlab:before{content:""}.fa-wpbeginner:before{content:""}.fa-wpforms:before{content:""}.fa-envira:before{content:""}.fa-universal-access:before{content:""}.fa-wheelchair-alt:before{content:""}.fa-question-circle-o:before{content:""}.fa-blind:before{content:""}.fa-audio-description:before{content:""}.fa-volume-control-phone:before{content:""}.fa-braille:before{content:""}.fa-assistive-listening-systems:before{content:""}.fa-american-sign-language-interpreting:before,.fa-asl-interpreting:before{content:""}.fa-deaf:before,.fa-deafness:before,.fa-hard-of-hearing:before{content:""}.fa-glide:before{content:""}.fa-glide-g:before{content:""}.fa-sign-language:before,.fa-signing:before{content:""}.fa-low-vision:before{content:""}.fa-viadeo:before{content:""}.fa-viadeo-square:before{content:""}.fa-snapchat:before{content:""}.fa-snapchat-ghost:before{content:""}.fa-snapchat-square:before{content:""}.fa-pied-piper:before{content:""}.fa-first-order:before{content:""}.fa-yoast:before{content:""}.fa-themeisle:before{content:""}.fa-google-plus-circle:before,.fa-google-plus-official:before{content:""}.fa-fa:before,.fa-font-awesome:before{content:""}.fa-handshake-o:before{content:""}.fa-envelope-open:before{content:""}.fa-envelope-open-o:before{content:""}.fa-linode:before{content:""}.fa-address-book:before{content:""}.fa-address-book-o:before{content:""}.fa-address-card:before,.fa-vcard:before{content:""}.fa-address-card-o:before,.fa-vcard-o:before{content:""}.fa-user-circle:before{content:""}.fa-user-circle-o:before{content:""}.fa-user-o:before{content:""}.fa-id-badge:before{content:""}.fa-drivers-license:before,.fa-id-card:before{content:""}.fa-drivers-license-o:before,.fa-id-card-o:before{content:""}.fa-quora:before{content:""}.fa-free-code-camp:before{content:""}.fa-telegram:before{content:""}.fa-thermometer-4:before,.fa-thermometer-full:before,.fa-thermometer:before{content:""}.fa-thermometer-3:before,.fa-thermometer-three-quarters:before{content:""}.fa-thermometer-2:before,.fa-thermometer-half:before{content:""}.fa-thermometer-1:before,.fa-thermometer-quarter:before{content:""}.fa-thermometer-0:before,.fa-thermometer-empty:before{content:""}.fa-shower:before{content:""}.fa-bath:before,.fa-bathtub:before,.fa-s15:before{content:""}.fa-podcast:before{content:""}.fa-window-maximize:before{content:""}.fa-window-minimize:before{content:""}.fa-window-restore:before{content:""}.fa-times-rectangle:before,.fa-window-close:before{content:""}.fa-times-rectangle-o:before,.fa-window-close-o:before{content:""}.fa-bandcamp:before{content:""}.fa-grav:before{content:""}.fa-etsy:before{content:""}.fa-imdb:before{content:""}.fa-ravelry:before{content:""}.fa-eercast:before{content:""}.fa-microchip:before{content:""}.fa-snowflake-o:before{content:""}.fa-superpowers:before{content:""}.fa-wpexplorer:before{content:""}.fa-meetup:before{content:""}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}body,html{overflow:hidden;height:100%}body{margin:0;padding:64px 0 0;font-family:'Open Sans',sans-serif;font-size:16px;font-weight:300;line-height:1.6;overflow:auto}h1,h2{font-family:"Roboto","Helvetica Neue",sans-serif}h1,h2,h3{font-weight:400}h1 code,h2 code,h3 code{background:0 0;padding:0;font-size:100%;color:inherit;background-color:none;font-family:inherit}h1,h2,h3,li,p,ul{word-break:break-word}pre,pre code{display:block;color:#333}pre{margin:0 0 10px;line-height:1.42857143;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;padding:9.5px;font-size:13px}pre code{overflow-x:auto;padding:.5em;background:0 0;-webkit-text-size-adjust:none;font-size:100%}.diffbox pre,table code{padding:0;background-color:none}.diffbox pre{display:block;margin:0;line-height:1.42857143;word-break:break-all;word-wrap:break-word;border:none;border-radius:0;font-size:13px;color:#333}code,code a{color:#c7254e}code{white-space:pre-wrap;padding:2px 4px;font-size:90%;background-color:#f9f2f4;border-radius:4px}code a{text-decoration:underline;transition:all .2s}code a:hover{color:#222}table{max-width:100%;overflow-x:scroll;border:1px solid #ddd;border-spacing:0;border-collapse:collapse;display:inline-block}table code{background:0 0;font-size:100%;color:inherit}td,th{padding:10px}th{background:#f1f1f1;text-align:left}td+td,th+th{border-left:1px solid #eee}td{border-top:1px solid #eee;vertical-align:top}img[alt=angular1-wa-ionic-cli],img[alt=angular1-wa-meteor-cli]{width:30%}.side-nav .api-list-item,.side-nav .step-item{margin:0;padding:0;color:#546e7a}.side-nav .step-item{position:relative}.side-nav .step-item::before{content:"";height:10px;width:10px;background:#f9f9f9;border-radius:50%;border:2px solid #a6120d;position:absolute;top:50%;margin-top:-6px;left:32px;margin-left:-6px;z-index:200;transition:all .2s ease-in-out}.side-nav .step-item.active-step::before,.side-nav .step-item:hover::before{background:#dd1b16;border-color:#dd1b16}.side-nav .active-step a,.side-nav .step-item:hover .step-link{color:#dd1b16}.side-nav .step-item::after{content:"";height:100%;width:1px;background:#a6120d;top:0;left:32px;position:absolute;z-index:100}.side-nav .step-item:first-of-type::after{height:50%;top:50%}.side-nav .step-item:last-of-type::after{height:50%;bottom:50%}.side-nav .step-link{color:#a6120d;transition:ease-in-out;text-decoration:none;display:block;font-size:14px;padding:16px 16px 16px calc(16px + 48px);margin:0}.side-nav .apis-list,.side-nav .apis-versions-list,.side-nav .tutorial-steps-list{list-style:none;padding-left:0;margin-top:8px}.apis-versions-list{margin:0!important}.apis-versions-list li{padding:0}.apis-versions-list li a{text-decoration:underline;color:#000}.dropdown-content{-moz-column-count:2;-moz-column-width:220px;-moz-column-rule:1px solid #eceff1;-moz-column-gap:0;column-count:2;column-width:220px;column-rule:1px solid #eceff1;column-gap:0}.dropdown-content .tutorial-steps-list{margin:0!important;list-style:none;padding:0}.dropdown-content .tutorial-steps-list .step-item{padding:5px 0 5px 10px;break-inside:avoid-column}.dropdown-content .tutorial-steps-list .step-item a{text-decoration:none;font-size:small;color:#000}.dropdown-content .tutorial-steps-list .step-item .bold{font-weight:700}[md-button].md-primary{background:0 0!important;color:#fff!important;cursor:pointer!important;border:2px solid #fff!important;border-radius:3px solid #fff!important;font-weight:400!important}[md-button].md-primary:hover{color:#fff!important;background-color:rgba(0,0,0,.1)!important}[md-button].md-primary[disabled]{color:#d3d3d3!important;cursor:not-allowed!important}[md-button]::after{display:none!important}.tutorial-button{border:2px solid #a6120d;background:0 0!important;color:#a6120d!important;box-shadow:none!important;padding:0 10px!important;margin-bottom:10px!important;transition:all .2s ease-in-out!important}.tutorial-button[disabled]{border-color:#dedede!important;color:#aaa!important;background:#dedede!important}.tutorial-button:hover{background:#dd1b16!important;color:#fff!important;border:2px solid #dd1b16!important}.tutorial-button.active{background:#a6120d!important;color:#fff!important;border:2px solid #a6120d!important}tutorial-page-content pre code[ngnonbindable]{background:#eee;display:block;width:90%;border-radius:5px;padding:10px}tutorial-page-content blockquote{margin:0;position:relative;background:#eee;border-radius:5px}tutorial-page-content blockquote:before{content:'!';font-weight:700;position:absolute;vertical-align:top;font-size:2vw;color:#fff;margin-left:6px}tutorial-page-content blockquote p{border-left:1px solid #fff;padding:10px;margin-left:20px}.diffbox{border-radius:10px}.diffbox .title-panel{border-radius:10px 10px 0 0}.diffbox .code-container{border-radius:0 0 10px 10px}api-ref-container p code,api-ref-container ul li code{font-family:'Open Sans',sans-serif}api-ref-container a{color:#263238;text-decoration:none;font-weight:700}api-ref-container h3{background:#eee;border-radius:5px;padding:4px;margin-top:30px}api-ref-container table{width:100%;background:#eee;border-radius:5px;border-spacing:0}api-ref-container table thead{color:#eee}api-ref-container table thead,api-ref-container table thead tr{background:#546e7a;border-radius:5px}api-ref-container table thead tr th{padding:6px}api-ref-container table tbody td{padding:5px}.l-pinned-top{position:fixed;top:0;left:0;right:0}.l-left{float:left}.l-right{float:right}.docs-content,.l-relative{position:relative}.l-absolute{position:absolute}.l-fixed{position:fixed}.l-offset-side-nav{padding-left:232px}diffbox-container{padding-left:36px;overflow:hidden;display:block}diffbox-container .hljs-comment{color:#777}diffbox-container pre{margin:0;padding:0;background-color:transparent}.side-nav{background:#f6f6f6;width:100%;bottom:0;z-index:100}.side-nav ul{margin-top:8px}.side-nav h1{padding:16px 0 0 32px}@media screen and (min-width:750px){.api-container,.tutorials-container{margin-top:40px}.api-container,.tutorial-inner-container{display:flex}.side-nav{width:40%;height:100%}.api-content,.tutorial-content{width:60%}[md-raised-button]{margin-bottom:0!important}}@media screen and (min-width:1000px){.api-container,.tutorials-container{width:80%;margin:40px auto 0}.top-navigation{display:flex;justify-content:space-between}.side-nav{width:25%;border-radius:2px}.api-content,.tutorial-content{max-width:75%;margin-left:30px}}.api-container,.api-container p,.tutorials-container,.tutorials-container p{color:#555}.api-container h1,.tutorials-container h1{font-family:"Roboto","Helvetica Neue",sans-serif;color:#111;line-height:1.1}.main-toolbar md-toolbar-row{height:auto!important;justify-content:space-between;flex-wrap:wrap}.nav-links [md-button]{min-width:0!important;font-weight:300!important;font-family:inherit!important}.nav-links .md-primary{color:#555!important}diffbox-container pre.line-added{background:#eaffea}diffbox-container pre.line-removed{background:#ff9ea2}.terminal-input{font-size:13px;font-family:monospace;background:0 0;border:none;color:#333;outline:none;margin-left:4.5px;margin-top:5px;resize:none}.anchor-offset{display:block;position:relative;top:-90px;visibility:hidden}.improve-code a{color:#000;padding:6px}.logo{width:auto;height:2em}@keyframes pulse{0%,to{transform:scale(1)}20%,80%{transform:scale(1.2)}50%{transform:scale(.9)}}.support-link button{padding-right:0!important}.support-link .notification{animation:pulse 1.5s 2;font-size:10px;color:#fff;background:rgba(255,0,0,.7);border-radius:50%;display:inline-block;height:18px;width:18px;text-align:center;line-height:20px;font-weight:700}.support-link .hide-support{visibility:hidden}.logo-link{line-height:0;padding:.5rem}.nav-links{width:100%;max-height:340px;overflow:scroll;transition:all .2s ease-in-out;position:relative;z-index:50;height:0}.nav-links.visible{height:340px}[md-icon-button].nav-toggle{border-radius:5px;border:1px solid rgba(0,0,0,.05);height:auto;width:auto;padding:5px 10px}[md-icon-button].nav-toggle::after{display:none}[md-icon-button].nav-toggle span{color:#333}.primary-nav{margin-top:10px}.main-toolbar{position:fixed;top:0;left:0;right:0;padding:0;background:#f6f6f6!important;overflow:hidden;z-index:500}.main-toolbar a{color:#555;text-decoration:none;font-weight:400;display:block}.nav-links{padding-right:120px}.nav-links a{padding:5px 0;border-radius:3px}.nav-links a:hover{background:#eee}.tutorials-dropdown{position:relative;display:inline-block;color:#555;padding:5px 0;line-height:1}.tutorials-dropdown .button-inner{display:flex;align-items:center}.tutorials-dropdown .dropdown-content{display:none;background-color:#fff;padding:7px;line-height:1.6}.tutorials-dropdown .dropdown-content.visible{display:block}@media screen and (min-width:1000px){.nav-links,.primary-nav{display:flex;align-items:center}.primary-nav{margin-top:0}[md-icon-button].nav-toggle{display:none}.nav-links{justify-content:space-between;width:100%;height:auto;overflow:visible}.nav-links a{display:inline-block}.secondary-nav{align-self:flex-end}.main-toolbar{overflow:visible}.main-toolbar md-toolbar-row{flex-wrap:nowrap}.tutorials-dropdown:hover{background:#eee}.tutorials-dropdown .dropdown-content{display:none;position:absolute;background-color:#fff;min-width:600px;box-shadow:0 6px 12px rgba(0,0,0,.175);border-radius:0;padding:5px 0!important;border:1px solid rgba(0,0,0,.15)}.tutorials-dropdown .dropdown-content a{padding:.4rem 20px;border-bottom:1px solid #f2f2f2;display:block;font-weight:300;font-size:16px}.tutorials-dropdown .dropdown-content .tutorial-steps-list .step-item{padding:0}}.clear{clear:both}p{font-size:1rem}.row{overflow:hidden}.hero{padding:3rem 0;background-image:url(assets/images/angular-bg.png);background-color:#333;text-align:center}.hero h1{color:#f6f6f6}.hero .buttons{margin-bottom:20px}.hero .main-logo{width:260px;height:260px;background-image:url(assets/images/logo-large.png);background-repeat:no-repeat;margin:0 auto 3rem;background-size:132%;background-position:-48px}[md-button].body-button,[md-raised-button].hero-button{font-weight:300;transition:all .2s;font-family:inherit;font-size:16px}[md-raised-button].hero-button{background:#a6120d;margin:5px;border:2px solid #fff;color:#fff}[md-button].body-button:hover,[md-raised-button].hero-button:hover{background:#dd1b16;border-color:#dd1b16}[md-button].body-button{background:0 0;border:2px solid #a6120d;color:#a6120d}[md-button].body-button:hover{color:#fff}.hero h1,.showcase h1,.video h1{font-size:1.7rem;line-height:1.4}.video h1{margin:3rem}.video{padding-bottom:2rem}.showcase h1{margin-bottom:3rem;margin-top:0}.main-unit{text-align:center;margin:0 auto}.main-unit .video-wrapper iframe{border:2px solid #333;background-color:#333;border-radius:3px}.main-unit .tutorial-cta{margin:3rem auto 2rem;max-width:400px}.container{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;text-align:center;margin-bottom:30px}.showcase .row{padding:0 3rem}.showcase .submit-app-cta{width:100%;float:left}.showcase .img-container{overflow:hidden;margin-bottom:15px;border-radius:5px;border:1px solid #dedede}.showcase .site-title{display:inline-block;padding:5px 20px;border-radius:5px;transition:all .5s}.showcase a:not(.btn){color:#536e7a}.showcase a:not(.btn):hover img{opacity:.5;transform:scale(1.15)}.showcase a:not(.btn):hover .site-title{background:#fff}.showcase img{width:100%;transition:all .5s}.sites{display:flex;flex-wrap:wrap;padding:0 2rem}.site{margin-bottom:30px;width:100%;box-sizing:border-box}.extras .container{display:flex;justify-content:space-between;flex-wrap:wrap}.unit,.unit p{text-align:center}.unit{width:100%;max-width:80%;margin:0 auto;padding:0 2rem;box-sizing:border-box}.unit p{font-size:16px}@media screen and (min-width:620px){.sites{padding:0}.site{padding:0 1rem}.video-wrapper iframe{width:500px;height:calc(500px*.5625)}.site,.unit{width:50%}}@media screen and (min-width:980px){.site{width:33.33%;padding:0 1rem}.video-wrapper iframe{width:700px;height:calc(700px*.5625)}}@media screen and (min-width:1200px){.site{width:25%;padding:0 1rem}.unit{width:33.33%}}.small-hero{color:#263238;padding:2rem;height:440px}.small-hero img{margin:1rem;height:148px}.small-hero p{max-width:240px;margin:1rem auto}.intro{padding-bottom:3rem;padding-top:3rem;background-color:#f2f2f2;margin:3rem auto;overflow:hidden}.intro h1{margin-bottom:4rem}.slides .slide-item{float:left;width:100%}.submit-app-cta p{margin:3rem auto 2rem;max-width:400px;text-align:center}@media screen and (min-width:768px){.slides .slide-item{width:50%}.showcase h1,.video h1{font-size:2rem}.container{width:80%}}a{text-decoration:none}.md-primary{background:#fff}.meteor-rxjs img{vertical-align:middle}.meteor-rxjs .plus{margin-left:0;margin-right:20px;font-weight:bolder}.meteor-rxjs .md-primary{margin:10px}.meteor-rxjs .container{color:#000}.meteor-rxjs .main-unit{background:#fff!important;color:#fff}.meteor-rxjs h1,.meteor-rxjs img{margin-bottom:1rem}.meteor-rxjs>p{max-width:480px;margin:2rem auto}.meteor-rxjs .header{text-align:center;padding-bottom:100px}.meteor-rxjs .header p{font-size:1.2rem;margin:0 auto 1rem}.api-content a{text-decoration:underline;color:#a6120d;transition:all .2s}.api-content a:hover{color:#222}.api-container .side-nav a{color:#222;transition:all .2s}.api-container .side-nav a:hover,ul.apis-list .api-item-link:hover{color:#dd1b16}.api-container .active-step a{color:#a6120d}.dropdown{position:relative;display:inline-block;margin-left:24px;margin-right:24px;margin-top:10px}.dropdown .dropdown-content{display:none;position:absolute;background-color:#fff;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);border-radius:5px;column-width:210px!important;column-count:1!important;font-size:1rem;width:100%}.dropdown .dropdown-content a{display:block;padding:8px}.dropdown .dropdown-content a:hover{background:#f2f2f2}.dropdown .dropdown-content li{border-bottom:1px solid #f2f2f2}tutorials-versions{text-align:center!important;margin-left:0;margin-top:10px;display:block}.dropdown:hover .dropdown-content{display:block}.api-content{margin-top:20px;padding:20px}[md-button].api-button{color:#333;border:none;text-align:left;display:inline-block;background:#d5d5d5;display:inline-flex;align-items:center;margin-top:16px}ul.apis-list{padding:16px 24px!important;border-top:1px solid #d5d5d5;margin-top:32px!important}ul.apis-list .api-item-link{display:block;font-size:16px;padding:8px 0;transition:all .2s}.api-content .deprecation-notice{background:#ffeaea;padding:1rem 1rem 1rem 65px;position:relative;border:2px solid #a53a3a;color:#a53a3a;border-radius:4px}.api-content .deprecation-notice::before{content:"error_outline";font-family:'Material Icons';width:65px;height:100%;position:absolute;top:0;left:0;font-style:normal;line-height:1;font-size:36px;display:flex;align-items:center;justify-content:center;color:#a53a3a}@media screen and (min-width:1000px){.api-content{margin-top:0;padding-top:0}.top-navigation{margin-top:20px;margin-bottom:60px}}markdown-file{padding:2rem;display:block}markdown-file hr{border:0;border-top:1px solid #dedede;margin:45px 0}@media screen and (min-width:750px){markdown-file{width:70%;margin:2rem auto}}@media screen and (min-width:1000px){markdown-file{width:50%}}.version-timeline .timeline{white-space:nowrap;overflow-x:scroll;padding:30px 0 10px;position:relative}.version-timeline .diff,.version-timeline .entry{display:inline-block;position:relative;text-align:center;border-radius:3px}.version-timeline .entry{padding:3px;background:#fff;color:#a6120d;border:1px solid #a6120d;margin-right:5px;margin-left:5px;vertical-align:top;font-size:10px;min-width:100px}.version-timeline .diff:after,.version-timeline .diff:before{visibility:hidden}.version-timeline .diff{min-width:initial!important;vertical-align:middle;font-size:9px;height:100%}.version-timeline .diff md-icon{height:auto!important}.tutorial-title .gh-link a,.version-timeline .diff a{color:#000}.version-timeline .diff,.version-timeline .diff:hover{background:0 0!important;color:#000!important}.version-timeline .current-version:after{background:#a6120d!important}.version-timeline .current-version,.version-timeline .entry:hover{background:#a6120d!important;color:#fff!important}.version-timeline .current-version h1,.version-timeline .entry:hover h1{color:#fff!important;font-weight:700!important}.version-timeline .current-version h4,.version-timeline .entry:hover h4{color:rgba(255,255,255,.56)!important}.version-timeline .entry:after{content:'';display:block;background:#eee;width:7px;height:7px;border-radius:6px;border:3px solid #a6120d;position:absolute;left:50%;top:-30px;margin-left:-7px}.version-timeline .entry:before{content:'';display:block;background:#a6120d;width:3px;height:20px;position:absolute;left:50%;top:-20px;margin-left:-2px}.version-timeline .entry h1{color:#a6120d;font-size:12px;margin-top:2px;margin-bottom:2px}.version-timeline .entry h4{margin:0;color:rgba(156,156,156,.56);font-weight:400}.version-timeline .bar{height:4px;background:#eee;width:100%;position:relative;top:10px;left:0}.tutorial-name{width:100%;border-bottom:1px #fff solid;padding:5px;text-align:center}.top-navigation{width:100%;z-index:50;margin-bottom:20px}.tutorial-content{margin-top:20px;padding:20px}.tutorial-nav{display:flex;align-items:center;margin-bottom:20px}.tutorial-nav a{font-size:13px;margin-right:10px}.improve{display:block}.tutorial-title{font-family:"Roboto","Helvetica Neue",sans-serif}.tutorial-title h1{text-align:center;margin-top:0;margin-bottom:10px}.tutorial-title h4{font-style:italic}.tutorial-title .gh-link,.tutorial-title h4{text-align:center;margin-top:0;margin-bottom:0}.tutorial-content blockquote{background:#fffbd8;margin:0;padding:0 1rem;font-size:.8rem;border:1px solid #d6d095;border-radius:4px;position:relative;padding-left:65px}.tutorial-content blockquote::before{content:"priority_high";font-size:36px;color:#c6b81d}.deprecated-tutorial,.zip-download{display:block;position:relative;border-radius:4px}.zip-download{margin-bottom:2rem;background:#fff;border:2px solid #bcd196;padding:1rem 1rem 1rem 65px;color:#789b37}.zip-download:hover{background:#f6ffe8}.deprecated-tutorial::before,.tutorial-content blockquote::before,.zip-download::before{font-family:'Material Icons';width:65px;height:100%;position:absolute;top:0;left:0;font-style:normal;line-height:1;display:flex;align-items:center;justify-content:center}.zip-download::before{color:#bcd196;content:"file_download";font-size:36px}.deprecated-tutorial{font-size:small;color:#a6120d;background:rgba(209,9,0,.02);padding:5px 5px 5px 65px;width:60%;margin:10px auto 15px}.deprecated-tutorial::before{content:"priority_high";font-size:24px;color:rgba(209,9,0,.5)}.youtube-container{border:1px solid #ccc}@media screen and (min-width:1000px){.tutorial-nav{padding:0;margin-bottom:0}.tutorial-content{margin-top:0;padding-top:0}.top-navigation{margin-top:20px;margin-bottom:60px}}.button-wrapper{display:flex;align-items:center;justify-content:center}.button-wrapper .material-icons{font-size:16px;padding-right:5px}.button-wrapper.right-icon .material-icons{padding-right:0;padding-left:10px}.tutorial-version{margin-left:16px}.active{color:#b3e5fc!important}.main-unit{background:#fff;color:#000;margin-top:10px}.support-page-wrapper{display:table;width:90%;border:1px solid #dadada;background:#f7f7f7;box-shadow:0 1px 2px 0 rgba(0,0,0,.1);border-radius:4px;margin:0 auto 40px}.support-page-wrapper .title{width:100%;display:table-caption;text-align:center;margin-bottom:30px}.support-page-wrapper .row{display:table-row;width:100%;margin-top:20px}.support-page-wrapper .row .divider{border-right:1px solid #dadada}.support-page-wrapper .row .column,.support-page-wrapper .row .full-column{width:50%;display:table-cell;padding-left:30px;padding-right:30px}.support-page-wrapper .row .full-column{width:100%}.support-page-wrapper .row .column .italic,.support-page-wrapper .row .full-column .italic{font-style:italic}.support-page-wrapper .row .column h2,.support-page-wrapper .row .full-column h2{letter-spacing:-.06em;text-align:center;margin-bottom:20px;color:#a6120d}.support-page-wrapper .row .full-column p{max-width:none}.img-title{margin:0 auto}.img-title,.title{text-align:center}.navigationButtons{text-align:center;margin-top:20px;margin-bottom:20px}.tutorial-links{margin-top:10px}.not-found-title,.tutorial-links{text-align:center}.not-found-circle{height:200px;background:#a6120d;width:200px;margin:0 auto;vertical-align:middle;line-height:200px;text-align:center;border-radius:200px;color:#fff;font-size:4em;font-weight:700}.not-found-links{text-align:center;width:100%}</style><universal-script><script>
 try {window.UNIVERSAL_CACHE = ({"APP_ID":"acaf"}) || {};} catch(e) {  console.warn("Angular Universal: There was a problem parsing data from the server")}
</script></universal-script></body></html>